import base64
import os
import shutil
from pathlib import Path
from typing import Dict


# this is base64 encoded source code
file_data: Dict = { # RandomSizedCrop(288, min_aspect=3/20, max_aspect=20/3, min_area=0.8)
                    'imet/transforms.py': 'aW1wb3J0IHJhbmRvbQppbXBvcnQgbWF0aAoKZnJvbSBQSUwgaW1wb3J0IEltYWdlCmZyb20gdG9yY2h2aXNpb24udHJhbnNmb3JtcyBpbXBvcnQgKAogICAgVG9UZW5zb3IsIE5vcm1hbGl6ZSwgQ29tcG9zZSwgUmVzaXplLCBDZW50ZXJDcm9wLCBSYW5kb21Dcm9wLAogICAgUmFuZG9tSG9yaXpvbnRhbEZsaXAsIFJhbmRvbVJlc2l6ZWRDcm9wKQoKCmNsYXNzIFJhbmRvbVNpemVkQ3JvcDoKICAgICIiIlJhbmRvbSBjcm9wIHRoZSBnaXZlbiBQSUwuSW1hZ2UgdG8gYSByYW5kb20gc2l6ZQogICAgb2YgdGhlIG9yaWdpbmFsIHNpemUgYW5kIGFuZCBhIHJhbmRvbSBhc3BlY3QgcmF0aW8KICAgIG9mIHRoZSBvcmlnaW5hbCBhc3BlY3QgcmF0aW8uCiAgICBzaXplOiBzaXplIG9mIHRoZSBzbWFsbGVyIGVkZ2UKICAgIGludGVycG9sYXRpb246IERlZmF1bHQ6IFBJTC5JbWFnZS5CSUxJTkVBUgogICAgIiIiCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNpemUsIGludGVycG9sYXRpb249SW1hZ2UuQklMSU5FQVIsCiAgICAgICAgICAgICAgICAgbWluX2FzcGVjdD00LzUsIG1heF9hc3BlY3Q9NS80LAogICAgICAgICAgICAgICAgIG1pbl9hcmVhPTAuMjUsIG1heF9hcmVhPTEpOgogICAgICAgIHNlbGYuc2l6ZSA9IHNpemUKICAgICAgICBzZWxmLmludGVycG9sYXRpb24gPSBpbnRlcnBvbGF0aW9uCiAgICAgICAgc2VsZi5taW5fYXNwZWN0ID0gbWluX2FzcGVjdAogICAgICAgIHNlbGYubWF4X2FzcGVjdCA9IG1heF9hc3BlY3QKICAgICAgICBzZWxmLm1pbl9hcmVhID0gbWluX2FyZWEKICAgICAgICBzZWxmLm1heF9hcmVhID0gbWF4X2FyZWEKCiAgICBkZWYgX19jYWxsX18oc2VsZiwgaW1nKToKICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgxMCk6CiAgICAgICAgICAgIGFyZWEgPSBpbWcuc2l6ZVswXSAqIGltZy5zaXplWzFdCiAgICAgICAgICAgIHRhcmdldF9hcmVhID0gcmFuZG9tLnVuaWZvcm0oc2VsZi5taW5fYXJlYSwgc2VsZi5tYXhfYXJlYSkgKiBhcmVhCiAgICAgICAgICAgIGFzcGVjdF9yYXRpbyA9IHJhbmRvbS51bmlmb3JtKHNlbGYubWluX2FzcGVjdCwgc2VsZi5tYXhfYXNwZWN0KQoKICAgICAgICAgICAgdyA9IGludChyb3VuZChtYXRoLnNxcnQodGFyZ2V0X2FyZWEgKiBhc3BlY3RfcmF0aW8pKSkKICAgICAgICAgICAgaCA9IGludChyb3VuZChtYXRoLnNxcnQodGFyZ2V0X2FyZWEgLyBhc3BlY3RfcmF0aW8pKSkKCiAgICAgICAgICAgIGlmIHJhbmRvbS5yYW5kb20oKSA8IDAuNToKICAgICAgICAgICAgICAgIHcsIGggPSBoLCB3CgogICAgICAgICAgICBpZiB3IDw9IGltZy5zaXplWzBdIGFuZCBoIDw9IGltZy5zaXplWzFdOgogICAgICAgICAgICAgICAgeDEgPSByYW5kb20ucmFuZGludCgwLCBpbWcuc2l6ZVswXSAtIHcpCiAgICAgICAgICAgICAgICB5MSA9IHJhbmRvbS5yYW5kaW50KDAsIGltZy5zaXplWzFdIC0gaCkKCiAgICAgICAgICAgICAgICBpbWcgPSBpbWcuY3JvcCgoeDEsIHkxLCB4MSArIHcsIHkxICsgaCkpCiAgICAgICAgICAgICAgICBhc3NlcnQoaW1nLnNpemUgPT0gKHcsIGgpKQoKICAgICAgICAgICAgICAgIHJldHVybiBpbWcucmVzaXplKChzZWxmLnNpemUsIHNlbGYuc2l6ZSksIHNlbGYuaW50ZXJwb2xhdGlvbikKCiAgICAgICAgIyBGYWxsYmFjawogICAgICAgIHNjYWxlID0gUmVzaXplKHNlbGYuc2l6ZSwgaW50ZXJwb2xhdGlvbj1zZWxmLmludGVycG9sYXRpb24pCiAgICAgICAgY3JvcCA9IENlbnRlckNyb3Aoc2VsZi5zaXplKQogICAgICAgIHJldHVybiBjcm9wKHNjYWxlKGltZykpCgoKdHJhaW5fdHJhbnNmb3JtID0gQ29tcG9zZShbCiAgICAjIFJhbmRvbUNyb3AoMzIwKSwKICAgICMgUmFuZG9tUmVzaXplZENyb3AoMzIwLCBzY2FsZT0oMC4wOCwgMS4wKSwgcmF0aW89KDEuMCwgMS4wKSksCiAgICBSYW5kb21TaXplZENyb3AoMjg4LCBtaW5fYXNwZWN0PTMvMjAsIG1heF9hc3BlY3Q9MjAvMywgbWluX2FyZWE9MC44KSwKICAgIFJhbmRvbUhvcml6b250YWxGbGlwKCksCl0pCgoKdGVzdF90cmFuc2Zvcm0gPSBDb21wb3NlKFsKICAgICMgUmFuZG9tQ3JvcCgzMjApLAogICAgIyBSYW5kb21SZXNpemVkQ3JvcCgzMjAsIHNjYWxlPSgwLjA4LCAxLjApLCByYXRpbz0oMS4wLCAxLjApKSwKICAgIFJhbmRvbVNpemVkQ3JvcCgyODgsIG1pbl9hc3BlY3Q9My8yMCwgbWF4X2FzcGVjdD0yMC8zLCBtaW5fYXJlYT0wLjgpLAogICAgUmFuZG9tSG9yaXpvbnRhbEZsaXAoKSwKXSkKCgp0ZW5zb3JfdHJhbnNmb3JtID0gQ29tcG9zZShbCiAgICBUb1RlbnNvcigpLAogICAgTm9ybWFsaXplKG1lYW49WzAuNDg1LCAwLjQ1NiwgMC40MDZdLCBzdGQ9WzAuMjI5LCAwLjIyNCwgMC4yMjVdKSwKXSkK',
                    'imet/make_submission.py': 'aW1wb3J0IGFyZ3BhcnNlCgppbXBvcnQgcGFuZGFzIGFzIHBkCgpmcm9tIC51dGlscyBpbXBvcnQgbWVhbl9kZgpmcm9tIC5kYXRhc2V0IGltcG9ydCBEQVRBX1JPT1QKZnJvbSAubWFpbiBpbXBvcnQgYmluYXJpemVfcHJlZGljdGlvbgoKCmRlZiBtYWluKCk6CiAgICBwYXJzZXIgPSBhcmdwYXJzZS5Bcmd1bWVudFBhcnNlcigpCiAgICBhcmcgPSBwYXJzZXIuYWRkX2FyZ3VtZW50CiAgICBhcmcoJ3ByZWRpY3Rpb25zJywgbmFyZ3M9JysnKQogICAgYXJnKCdvdXRwdXQnKQogICAgYXJnKCctLXRocmVzaG9sZCcsIHR5cGU9ZmxvYXQsIGRlZmF1bHQ9MC4yKQogICAgYXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkKICAgIHNhbXBsZV9zdWJtaXNzaW9uID0gcGQucmVhZF9jc3YoCiAgICAgICAgREFUQV9ST09UIC8gJ3NhbXBsZV9zdWJtaXNzaW9uLmNzdicsIGluZGV4X2NvbD0naWQnKQogICAgZGZzID0gW10KICAgIGZvciBwcmVkaWN0aW9uIGluIGFyZ3MucHJlZGljdGlvbnM6CiAgICAgICAgZGYgPSBwZC5yZWFkX2hkZihwcmVkaWN0aW9uLCBpbmRleF9jb2w9J2lkJykKICAgICAgICBkZiA9IGRmLnJlaW5kZXgoc2FtcGxlX3N1Ym1pc3Npb24uaW5kZXgpCiAgICAgICAgZGZzLmFwcGVuZChkZikKICAgIGRmID0gcGQuY29uY2F0KGRmcykKICAgIGRmID0gbWVhbl9kZihkZikKICAgIGRmWzpdID0gYmluYXJpemVfcHJlZGljdGlvbihkZi52YWx1ZXMsIHRocmVzaG9sZD1hcmdzLnRocmVzaG9sZCkKICAgIGRmID0gZGYuYXBwbHkoZ2V0X2NsYXNzZXMsIGF4aXM9MSkKICAgIGRmLm5hbWUgPSAnYXR0cmlidXRlX2lkcycKICAgIGRmLnRvX2NzdihhcmdzLm91dHB1dCwgaGVhZGVyPVRydWUpCgoKZGVmIGdldF9jbGFzc2VzKGl0ZW0pOgogICAgcmV0dXJuICcgJy5qb2luKGNscyBmb3IgY2xzLCBpc19wcmVzZW50IGluIGl0ZW0uaXRlbXMoKSBpZiBpc19wcmVzZW50KQoKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCkK',
                    'imet/models.py': 'aW1wb3J0IG1hdGgKZnJvbSBjb2xsZWN0aW9ucyBpbXBvcnQgT3JkZXJlZERpY3QKZnJvbSBmdW5jdG9vbHMgaW1wb3J0IHBhcnRpYWwKCmltcG9ydCB0b3JjaApmcm9tIHRvcmNoIGltcG9ydCBubgpmcm9tIHRvcmNoLm5uIGltcG9ydCBmdW5jdGlvbmFsIGFzIEYKaW1wb3J0IHRvcmNodmlzaW9uLm1vZGVscyBhcyBNCgpmcm9tIC51dGlscyBpbXBvcnQgT05fS0FHR0xFCgoKY2xhc3MgU0VNb2R1bGUobm4uTW9kdWxlKToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgY2hhbm5lbHMsIHJlZHVjdGlvbik6CiAgICAgICAgc3VwZXIoU0VNb2R1bGUsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLmF2Z19wb29sID0gbm4uQWRhcHRpdmVBdmdQb29sMmQoMSkKICAgICAgICBzZWxmLmZjMSA9IG5uLkNvbnYyZChjaGFubmVscywgY2hhbm5lbHMgLy8gcmVkdWN0aW9uLCBrZXJuZWxfc2l6ZT0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc9MCkKICAgICAgICBzZWxmLnJlbHUgPSBubi5SZUxVKGlucGxhY2U9VHJ1ZSkKICAgICAgICBzZWxmLmZjMiA9IG5uLkNvbnYyZChjaGFubmVscyAvLyByZWR1Y3Rpb24sIGNoYW5uZWxzLCBrZXJuZWxfc2l6ZT0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc9MCkKICAgICAgICBzZWxmLnNpZ21vaWQgPSBubi5TaWdtb2lkKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICBtb2R1bGVfaW5wdXQgPSB4CiAgICAgICAgeCA9IHNlbGYuYXZnX3Bvb2woeCkKICAgICAgICB4ID0gc2VsZi5mYzEoeCkKICAgICAgICB4ID0gc2VsZi5yZWx1KHgpCiAgICAgICAgeCA9IHNlbGYuZmMyKHgpCiAgICAgICAgeCA9IHNlbGYuc2lnbW9pZCh4KQogICAgICAgIHJldHVybiBtb2R1bGVfaW5wdXQgKiB4CgoKY2xhc3MgQm90dGxlbmVjayhubi5Nb2R1bGUpOgogICAgIiIiCiAgICBCYXNlIGNsYXNzIGZvciBib3R0bGVuZWNrcyB0aGF0IGltcGxlbWVudHMgYGZvcndhcmQoKWAgbWV0aG9kLgogICAgIiIiCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXNpZHVhbCA9IHgKCiAgICAgICAgb3V0ID0gc2VsZi5jb252MSh4KQogICAgICAgIG91dCA9IHNlbGYuYm4xKG91dCkKICAgICAgICBvdXQgPSBzZWxmLnJlbHUob3V0KQoKICAgICAgICBvdXQgPSBzZWxmLmNvbnYyKG91dCkKICAgICAgICBvdXQgPSBzZWxmLmJuMihvdXQpCiAgICAgICAgb3V0ID0gc2VsZi5yZWx1KG91dCkKCiAgICAgICAgb3V0ID0gc2VsZi5jb252MyhvdXQpCiAgICAgICAgb3V0ID0gc2VsZi5ibjMob3V0KQoKICAgICAgICBpZiBzZWxmLmRvd25zYW1wbGUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJlc2lkdWFsID0gc2VsZi5kb3duc2FtcGxlKHgpCgogICAgICAgIG91dCA9IHNlbGYuc2VfbW9kdWxlKG91dCkgKyByZXNpZHVhbAogICAgICAgIG91dCA9IHNlbGYucmVsdShvdXQpCgogICAgICAgIHJldHVybiBvdXQKCgpjbGFzcyBTRUJvdHRsZW5lY2soQm90dGxlbmVjayk6CiAgICAiIiIKICAgIEJvdHRsZW5lY2sgZm9yIFNFTmV0MTU0LgogICAgIiIiCiAgICBleHBhbnNpb24gPSA0CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGlucGxhbmVzLCBwbGFuZXMsIGdyb3VwcywgcmVkdWN0aW9uLCBzdHJpZGU9MSwKICAgICAgICAgICAgICAgICBkb3duc2FtcGxlPU5vbmUpOgogICAgICAgIHN1cGVyKFNFQm90dGxlbmVjaywgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYuY29udjEgPSBubi5Db252MmQoaW5wbGFuZXMsIHBsYW5lcyAqIDIsIGtlcm5lbF9zaXplPTEsIGJpYXM9RmFsc2UpCiAgICAgICAgc2VsZi5ibjEgPSBubi5CYXRjaE5vcm0yZChwbGFuZXMgKiAyKQogICAgICAgIHNlbGYuY29udjIgPSBubi5Db252MmQocGxhbmVzICogMiwgcGxhbmVzICogNCwga2VybmVsX3NpemU9MywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmlkZT1zdHJpZGUsIHBhZGRpbmc9MSwgZ3JvdXBzPWdyb3VwcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpYXM9RmFsc2UpCiAgICAgICAgc2VsZi5ibjIgPSBubi5CYXRjaE5vcm0yZChwbGFuZXMgKiA0KQogICAgICAgIHNlbGYuY29udjMgPSBubi5Db252MmQocGxhbmVzICogNCwgcGxhbmVzICogNCwga2VybmVsX3NpemU9MSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpYXM9RmFsc2UpCiAgICAgICAgc2VsZi5ibjMgPSBubi5CYXRjaE5vcm0yZChwbGFuZXMgKiA0KQogICAgICAgIHNlbGYucmVsdSA9IG5uLlJlTFUoaW5wbGFjZT1UcnVlKQogICAgICAgIHNlbGYuc2VfbW9kdWxlID0gU0VNb2R1bGUocGxhbmVzICogNCwgcmVkdWN0aW9uPXJlZHVjdGlvbikKICAgICAgICBzZWxmLmRvd25zYW1wbGUgPSBkb3duc2FtcGxlCiAgICAgICAgc2VsZi5zdHJpZGUgPSBzdHJpZGUKCgpjbGFzcyBTRVJlc05ldEJvdHRsZW5lY2soQm90dGxlbmVjayk6CiAgICAiIiIKICAgIFJlc05ldCBib3R0bGVuZWNrIHdpdGggYSBTcXVlZXplLWFuZC1FeGNpdGF0aW9uIG1vZHVsZS4gSXQgZm9sbG93cyBDYWZmZQogICAgaW1wbGVtZW50YXRpb24gYW5kIHVzZXMgYHN0cmlkZT1zdHJpZGVgIGluIGBjb252MWAgYW5kIG5vdCBpbiBgY29udjJgCiAgICAodGhlIGxhdHRlciBpcyB1c2VkIGluIHRoZSB0b3JjaHZpc2lvbiBpbXBsZW1lbnRhdGlvbiBvZiBSZXNOZXQpLgogICAgIiIiCiAgICBleHBhbnNpb24gPSA0CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGlucGxhbmVzLCBwbGFuZXMsIGdyb3VwcywgcmVkdWN0aW9uLCBzdHJpZGU9MSwKICAgICAgICAgICAgICAgICBkb3duc2FtcGxlPU5vbmUpOgogICAgICAgIHN1cGVyKFNFUmVzTmV0Qm90dGxlbmVjaywgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYuY29udjEgPSBubi5Db252MmQoaW5wbGFuZXMsIHBsYW5lcywga2VybmVsX3NpemU9MSwgYmlhcz1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmlkZT1zdHJpZGUpCiAgICAgICAgc2VsZi5ibjEgPSBubi5CYXRjaE5vcm0yZChwbGFuZXMpCiAgICAgICAgc2VsZi5jb252MiA9IG5uLkNvbnYyZChwbGFuZXMsIHBsYW5lcywga2VybmVsX3NpemU9MywgcGFkZGluZz0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzPWdyb3VwcywgYmlhcz1GYWxzZSkKICAgICAgICBzZWxmLmJuMiA9IG5uLkJhdGNoTm9ybTJkKHBsYW5lcykKICAgICAgICBzZWxmLmNvbnYzID0gbm4uQ29udjJkKHBsYW5lcywgcGxhbmVzICogNCwga2VybmVsX3NpemU9MSwgYmlhcz1GYWxzZSkKICAgICAgICBzZWxmLmJuMyA9IG5uLkJhdGNoTm9ybTJkKHBsYW5lcyAqIDQpCiAgICAgICAgc2VsZi5yZWx1ID0gbm4uUmVMVShpbnBsYWNlPVRydWUpCiAgICAgICAgc2VsZi5zZV9tb2R1bGUgPSBTRU1vZHVsZShwbGFuZXMgKiA0LCByZWR1Y3Rpb249cmVkdWN0aW9uKQogICAgICAgIHNlbGYuZG93bnNhbXBsZSA9IGRvd25zYW1wbGUKICAgICAgICBzZWxmLnN0cmlkZSA9IHN0cmlkZQoKCmNsYXNzIFNFUmVzTmVYdEJvdHRsZW5lY2soQm90dGxlbmVjayk6CiAgICAiIiIKICAgIFJlc05lWHQgYm90dGxlbmVjayB0eXBlIEMgd2l0aCBhIFNxdWVlemUtYW5kLUV4Y2l0YXRpb24gbW9kdWxlLgogICAgIiIiCiAgICBleHBhbnNpb24gPSA0CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGlucGxhbmVzLCBwbGFuZXMsIGdyb3VwcywgcmVkdWN0aW9uLCBzdHJpZGU9MSwKICAgICAgICAgICAgICAgICBkb3duc2FtcGxlPU5vbmUsIGJhc2Vfd2lkdGg9NCk6CiAgICAgICAgc3VwZXIoU0VSZXNOZVh0Qm90dGxlbmVjaywgc2VsZikuX19pbml0X18oKQogICAgICAgIHdpZHRoID0gbWF0aC5mbG9vcihwbGFuZXMgKiAoYmFzZV93aWR0aCAvIDY0KSkgKiBncm91cHMKICAgICAgICBzZWxmLmNvbnYxID0gbm4uQ29udjJkKGlucGxhbmVzLCB3aWR0aCwga2VybmVsX3NpemU9MSwgYmlhcz1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmlkZT0xKQogICAgICAgIHNlbGYuYm4xID0gbm4uQmF0Y2hOb3JtMmQod2lkdGgpCiAgICAgICAgc2VsZi5jb252MiA9IG5uLkNvbnYyZCh3aWR0aCwgd2lkdGgsIGtlcm5lbF9zaXplPTMsIHN0cmlkZT1zdHJpZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nPTEsIGdyb3Vwcz1ncm91cHMsIGJpYXM9RmFsc2UpCiAgICAgICAgc2VsZi5ibjIgPSBubi5CYXRjaE5vcm0yZCh3aWR0aCkKICAgICAgICBzZWxmLmNvbnYzID0gbm4uQ29udjJkKHdpZHRoLCBwbGFuZXMgKiA0LCBrZXJuZWxfc2l6ZT0xLCBiaWFzPUZhbHNlKQogICAgICAgIHNlbGYuYm4zID0gbm4uQmF0Y2hOb3JtMmQocGxhbmVzICogNCkKICAgICAgICBzZWxmLnJlbHUgPSBubi5SZUxVKGlucGxhY2U9VHJ1ZSkKICAgICAgICBzZWxmLnNlX21vZHVsZSA9IFNFTW9kdWxlKHBsYW5lcyAqIDQsIHJlZHVjdGlvbj1yZWR1Y3Rpb24pCiAgICAgICAgc2VsZi5kb3duc2FtcGxlID0gZG93bnNhbXBsZQogICAgICAgIHNlbGYuc3RyaWRlID0gc3RyaWRlCgoKY2xhc3MgU0VOZXQobm4uTW9kdWxlKToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgYmxvY2ssIGxheWVycywgZ3JvdXBzLCByZWR1Y3Rpb24sIGRyb3BvdXRfcD0wLjIsCiAgICAgICAgICAgICAgICAgaW5wbGFuZXM9MTI4LCBpbnB1dF8zeDM9VHJ1ZSwgZG93bnNhbXBsZV9rZXJuZWxfc2l6ZT0zLAogICAgICAgICAgICAgICAgIGRvd25zYW1wbGVfcGFkZGluZz0xLCBudW1fY2xhc3Nlcz0xMDAwKToKICAgICAgICAiIiIKICAgICAgICBQYXJhbWV0ZXJzCiAgICAgICAgLS0tLS0tLS0tLQogICAgICAgIGJsb2NrIChubi5Nb2R1bGUpOiBCb3R0bGVuZWNrIGNsYXNzLgogICAgICAgICAgICAtIEZvciBTRU5ldDE1NDogU0VCb3R0bGVuZWNrCiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05ldCBtb2RlbHM6IFNFUmVzTmV0Qm90dGxlbmVjawogICAgICAgICAgICAtIEZvciBTRS1SZXNOZVh0IG1vZGVsczogIFNFUmVzTmVYdEJvdHRsZW5lY2sKICAgICAgICBsYXllcnMgKGxpc3Qgb2YgaW50cyk6IE51bWJlciBvZiByZXNpZHVhbCBibG9ja3MgZm9yIDQgbGF5ZXJzIG9mIHRoZQogICAgICAgICAgICBuZXR3b3JrIChsYXllcjEuLi5sYXllcjQpLgogICAgICAgIGdyb3VwcyAoaW50KTogTnVtYmVyIG9mIGdyb3VwcyBmb3IgdGhlIDN4MyBjb252b2x1dGlvbiBpbiBlYWNoCiAgICAgICAgICAgIGJvdHRsZW5lY2sgYmxvY2suCiAgICAgICAgICAgIC0gRm9yIFNFTmV0MTU0OiA2NAogICAgICAgICAgICAtIEZvciBTRS1SZXNOZXQgbW9kZWxzOiAxCiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05lWHQgbW9kZWxzOiAgMzIKICAgICAgICByZWR1Y3Rpb24gKGludCk6IFJlZHVjdGlvbiByYXRpbyBmb3IgU3F1ZWV6ZS1hbmQtRXhjaXRhdGlvbiBtb2R1bGVzLgogICAgICAgICAgICAtIEZvciBhbGwgbW9kZWxzOiAxNgogICAgICAgIGRyb3BvdXRfcCAoZmxvYXQgb3IgTm9uZSk6IERyb3AgcHJvYmFiaWxpdHkgZm9yIHRoZSBEcm9wb3V0IGxheWVyLgogICAgICAgICAgICBJZiBgTm9uZWAgdGhlIERyb3BvdXQgbGF5ZXIgaXMgbm90IHVzZWQuCiAgICAgICAgICAgIC0gRm9yIFNFTmV0MTU0OiAwLjIKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmV0IG1vZGVsczogTm9uZQogICAgICAgICAgICAtIEZvciBTRS1SZXNOZVh0IG1vZGVsczogTm9uZQogICAgICAgIGlucGxhbmVzIChpbnQpOiAgTnVtYmVyIG9mIGlucHV0IGNoYW5uZWxzIGZvciBsYXllcjEuCiAgICAgICAgICAgIC0gRm9yIFNFTmV0MTU0OiAxMjgKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmV0IG1vZGVsczogNjQKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmVYdCBtb2RlbHM6IDY0CiAgICAgICAgaW5wdXRfM3gzIChib29sKTogSWYgYFRydWVgLCB1c2UgdGhyZWUgM3gzIGNvbnZvbHV0aW9ucyBpbnN0ZWFkIG9mCiAgICAgICAgICAgIGEgc2luZ2xlIDd4NyBjb252b2x1dGlvbiBpbiBsYXllcjAuCiAgICAgICAgICAgIC0gRm9yIFNFTmV0MTU0OiBUcnVlCiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05ldCBtb2RlbHM6IEZhbHNlCiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05lWHQgbW9kZWxzOiBGYWxzZQogICAgICAgIGRvd25zYW1wbGVfa2VybmVsX3NpemUgKGludCk6IEtlcm5lbCBzaXplIGZvciBkb3duc2FtcGxpbmcgY29udm9sdXRpb25zCiAgICAgICAgICAgIGluIGxheWVyMiwgbGF5ZXIzIGFuZCBsYXllcjQuCiAgICAgICAgICAgIC0gRm9yIFNFTmV0MTU0OiAzCiAgICAgICAgICAgIC0gRm9yIFNFLVJlc05ldCBtb2RlbHM6IDEKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmVYdCBtb2RlbHM6IDEKICAgICAgICBkb3duc2FtcGxlX3BhZGRpbmcgKGludCk6IFBhZGRpbmcgZm9yIGRvd25zYW1wbGluZyBjb252b2x1dGlvbnMgaW4KICAgICAgICAgICAgbGF5ZXIyLCBsYXllcjMgYW5kIGxheWVyNC4KICAgICAgICAgICAgLSBGb3IgU0VOZXQxNTQ6IDEKICAgICAgICAgICAgLSBGb3IgU0UtUmVzTmV0IG1vZGVsczogMAogICAgICAgICAgICAtIEZvciBTRS1SZXNOZVh0IG1vZGVsczogMAogICAgICAgIG51bV9jbGFzc2VzIChpbnQpOiBOdW1iZXIgb2Ygb3V0cHV0cyBpbiBgbGFzdF9saW5lYXJgIGxheWVyLgogICAgICAgICAgICAtIEZvciBhbGwgbW9kZWxzOiAxMDAwCiAgICAgICAgIiIiCiAgICAgICAgc3VwZXIoU0VOZXQsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLmlucGxhbmVzID0gaW5wbGFuZXMKICAgICAgICBpZiBpbnB1dF8zeDM6CiAgICAgICAgICAgIGxheWVyMF9tb2R1bGVzID0gWwogICAgICAgICAgICAgICAgKCdjb252MScsIG5uLkNvbnYyZCgzLCA2NCwgMywgc3RyaWRlPTIsIHBhZGRpbmc9MSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlhcz1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCdibjEnLCBubi5CYXRjaE5vcm0yZCg2NCkpLAogICAgICAgICAgICAgICAgKCdyZWx1MScsIG5uLlJlTFUoaW5wbGFjZT1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NvbnYyJywgbm4uQ29udjJkKDY0LCA2NCwgMywgc3RyaWRlPTEsIHBhZGRpbmc9MSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlhcz1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCdibjInLCBubi5CYXRjaE5vcm0yZCg2NCkpLAogICAgICAgICAgICAgICAgKCdyZWx1MicsIG5uLlJlTFUoaW5wbGFjZT1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2NvbnYzJywgbm4uQ29udjJkKDY0LCBpbnBsYW5lcywgMywgc3RyaWRlPTEsIHBhZGRpbmc9MSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlhcz1GYWxzZSkpLAogICAgICAgICAgICAgICAgKCdibjMnLCBubi5CYXRjaE5vcm0yZChpbnBsYW5lcykpLAogICAgICAgICAgICAgICAgKCdyZWx1MycsIG5uLlJlTFUoaW5wbGFjZT1UcnVlKSksCiAgICAgICAgICAgIF0KICAgICAgICBlbHNlOgogICAgICAgICAgICBsYXllcjBfbW9kdWxlcyA9IFsKICAgICAgICAgICAgICAgICgnY29udjEnLCBubi5Db252MmQoMywgaW5wbGFuZXMsIGtlcm5lbF9zaXplPTcsIHN0cmlkZT0yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nPTMsIGJpYXM9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgnYm4xJywgbm4uQmF0Y2hOb3JtMmQoaW5wbGFuZXMpKSwKICAgICAgICAgICAgICAgICgncmVsdTEnLCBubi5SZUxVKGlucGxhY2U9VHJ1ZSkpLAogICAgICAgICAgICBdCiAgICAgICAgIyBUbyBwcmVzZXJ2ZSBjb21wYXRpYmlsaXR5IHdpdGggQ2FmZmUgd2VpZ2h0cyBgY2VpbF9tb2RlPVRydWVgCiAgICAgICAgIyBpcyB1c2VkIGluc3RlYWQgb2YgYHBhZGRpbmc9MWAuCiAgICAgICAgbGF5ZXIwX21vZHVsZXMuYXBwZW5kKCgncG9vbCcsIG5uLk1heFBvb2wyZCgzLCBzdHJpZGU9MiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlaWxfbW9kZT1UcnVlKSkpCiAgICAgICAgc2VsZi5sYXllcjAgPSBubi5TZXF1ZW50aWFsKE9yZGVyZWREaWN0KGxheWVyMF9tb2R1bGVzKSkKICAgICAgICBzZWxmLmxheWVyMSA9IHNlbGYuX21ha2VfbGF5ZXIoCiAgICAgICAgICAgIGJsb2NrLAogICAgICAgICAgICBwbGFuZXM9NjQsCiAgICAgICAgICAgIGJsb2Nrcz1sYXllcnNbMF0sCiAgICAgICAgICAgIGdyb3Vwcz1ncm91cHMsCiAgICAgICAgICAgIHJlZHVjdGlvbj1yZWR1Y3Rpb24sCiAgICAgICAgICAgIGRvd25zYW1wbGVfa2VybmVsX3NpemU9MSwKICAgICAgICAgICAgZG93bnNhbXBsZV9wYWRkaW5nPTAKICAgICAgICApCiAgICAgICAgc2VsZi5sYXllcjIgPSBzZWxmLl9tYWtlX2xheWVyKAogICAgICAgICAgICBibG9jaywKICAgICAgICAgICAgcGxhbmVzPTEyOCwKICAgICAgICAgICAgYmxvY2tzPWxheWVyc1sxXSwKICAgICAgICAgICAgc3RyaWRlPTIsCiAgICAgICAgICAgIGdyb3Vwcz1ncm91cHMsCiAgICAgICAgICAgIHJlZHVjdGlvbj1yZWR1Y3Rpb24sCiAgICAgICAgICAgIGRvd25zYW1wbGVfa2VybmVsX3NpemU9ZG93bnNhbXBsZV9rZXJuZWxfc2l6ZSwKICAgICAgICAgICAgZG93bnNhbXBsZV9wYWRkaW5nPWRvd25zYW1wbGVfcGFkZGluZwogICAgICAgICkKICAgICAgICBzZWxmLmxheWVyMyA9IHNlbGYuX21ha2VfbGF5ZXIoCiAgICAgICAgICAgIGJsb2NrLAogICAgICAgICAgICBwbGFuZXM9MjU2LAogICAgICAgICAgICBibG9ja3M9bGF5ZXJzWzJdLAogICAgICAgICAgICBzdHJpZGU9MiwKICAgICAgICAgICAgZ3JvdXBzPWdyb3VwcywKICAgICAgICAgICAgcmVkdWN0aW9uPXJlZHVjdGlvbiwKICAgICAgICAgICAgZG93bnNhbXBsZV9rZXJuZWxfc2l6ZT1kb3duc2FtcGxlX2tlcm5lbF9zaXplLAogICAgICAgICAgICBkb3duc2FtcGxlX3BhZGRpbmc9ZG93bnNhbXBsZV9wYWRkaW5nCiAgICAgICAgKQogICAgICAgIHNlbGYubGF5ZXI0ID0gc2VsZi5fbWFrZV9sYXllcigKICAgICAgICAgICAgYmxvY2ssCiAgICAgICAgICAgIHBsYW5lcz01MTIsCiAgICAgICAgICAgIGJsb2Nrcz1sYXllcnNbM10sCiAgICAgICAgICAgIHN0cmlkZT0yLAogICAgICAgICAgICBncm91cHM9Z3JvdXBzLAogICAgICAgICAgICByZWR1Y3Rpb249cmVkdWN0aW9uLAogICAgICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplPWRvd25zYW1wbGVfa2VybmVsX3NpemUsCiAgICAgICAgICAgIGRvd25zYW1wbGVfcGFkZGluZz1kb3duc2FtcGxlX3BhZGRpbmcKICAgICAgICApCiAgICAgICAgc2VsZi5hdmdfcG9vbCA9IG5uLkF2Z1Bvb2wyZCg3LCBzdHJpZGU9MSkKICAgICAgICBzZWxmLmRyb3BvdXQgPSBubi5Ecm9wb3V0KGRyb3BvdXRfcCkgaWYgZHJvcG91dF9wIGlzIG5vdCBOb25lIGVsc2UgTm9uZQogICAgICAgIHNlbGYubGFzdF9saW5lYXIgPSBubi5MaW5lYXIoNTEyICogYmxvY2suZXhwYW5zaW9uLCBudW1fY2xhc3NlcykKCiAgICBkZWYgX21ha2VfbGF5ZXIoc2VsZiwgYmxvY2ssIHBsYW5lcywgYmxvY2tzLCBncm91cHMsIHJlZHVjdGlvbiwgc3RyaWRlPTEsCiAgICAgICAgICAgICAgICAgICAgZG93bnNhbXBsZV9rZXJuZWxfc2l6ZT0xLCBkb3duc2FtcGxlX3BhZGRpbmc9MCk6CiAgICAgICAgZG93bnNhbXBsZSA9IE5vbmUKICAgICAgICBpZiBzdHJpZGUgIT0gMSBvciBzZWxmLmlucGxhbmVzICE9IHBsYW5lcyAqIGJsb2NrLmV4cGFuc2lvbjoKICAgICAgICAgICAgZG93bnNhbXBsZSA9IG5uLlNlcXVlbnRpYWwoCiAgICAgICAgICAgICAgICBubi5Db252MmQoc2VsZi5pbnBsYW5lcywgcGxhbmVzICogYmxvY2suZXhwYW5zaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIGtlcm5lbF9zaXplPWRvd25zYW1wbGVfa2VybmVsX3NpemUsIHN0cmlkZT1zdHJpZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZz1kb3duc2FtcGxlX3BhZGRpbmcsIGJpYXM9RmFsc2UpLAogICAgICAgICAgICAgICAgbm4uQmF0Y2hOb3JtMmQocGxhbmVzICogYmxvY2suZXhwYW5zaW9uKSwKICAgICAgICAgICAgKQoKICAgICAgICBsYXllcnMgPSBbXQogICAgICAgIGxheWVycy5hcHBlbmQoYmxvY2soc2VsZi5pbnBsYW5lcywgcGxhbmVzLCBncm91cHMsIHJlZHVjdGlvbiwgc3RyaWRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bnNhbXBsZSkpCiAgICAgICAgc2VsZi5pbnBsYW5lcyA9IHBsYW5lcyAqIGJsb2NrLmV4cGFuc2lvbgogICAgICAgIGZvciBpIGluIHJhbmdlKDEsIGJsb2Nrcyk6CiAgICAgICAgICAgIGxheWVycy5hcHBlbmQoYmxvY2soc2VsZi5pbnBsYW5lcywgcGxhbmVzLCBncm91cHMsIHJlZHVjdGlvbikpCgogICAgICAgIHJldHVybiBubi5TZXF1ZW50aWFsKCpsYXllcnMpCgogICAgZGVmIGZlYXR1cmVzKHNlbGYsIHgpOgogICAgICAgIHggPSBzZWxmLmxheWVyMCh4KQogICAgICAgIHggPSBzZWxmLmxheWVyMSh4KQogICAgICAgIHggPSBzZWxmLmxheWVyMih4KQogICAgICAgIHggPSBzZWxmLmxheWVyMyh4KQogICAgICAgIHggPSBzZWxmLmxheWVyNCh4KQogICAgICAgIHJldHVybiB4CgogICAgZGVmIGxvZ2l0cyhzZWxmLCB4KToKICAgICAgICB4ID0gc2VsZi5hdmdfcG9vbCh4KQogICAgICAgIGlmIHNlbGYuZHJvcG91dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgeCA9IHNlbGYuZHJvcG91dCh4KQogICAgICAgIHggPSB4LnZpZXcoeC5zaXplKDApLCAtMSkKICAgICAgICB4ID0gc2VsZi5sYXN0X2xpbmVhcih4KQogICAgICAgIHJldHVybiB4CgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgeCA9IHNlbGYuZmVhdHVyZXMoeCkKICAgICAgICB4ID0gc2VsZi5sb2dpdHMoeCkKICAgICAgICByZXR1cm4geAoKCmNsYXNzIFNFUmVzTmV0NTAobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1fY2xhc3NlcywgcHJldHJhaW5lZD1GYWxzZSwgZHJvcG91dD1GYWxzZSwgbmV0X2Nscz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm5ldCA9IFNFTmV0KFNFUmVzTmV0Qm90dGxlbmVjaywgWzMsNCw2LDNdLCBncm91cHM9MSwgcmVkdWN0aW9uPTE2LAogICAgICAgICAgICAgICAgICAgICAgICAgZHJvcG91dF9wPU5vbmUsIGlucGxhbmVzPTY0LCBpbnB1dF8zeDM9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplPTEsIGRvd25zYW1wbGVfcGFkZGluZz0wLAogICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2NsYXNzZXM9MTAwMCkKICAgICAgICB3ZWlnaHRzX3BhdGggPSBmJy4uL2lucHV0L3NlX3Jlc25ldDUwL3NlX3Jlc25ldDUwLnB0aCcKICAgICAgICBzZWxmLm5ldC5sb2FkX3N0YXRlX2RpY3QodG9yY2gubG9hZCh3ZWlnaHRzX3BhdGgpKQogICAgICAgIHNlbGYubmV0LmF2Z19wb29sID0gQXZnUG9vbCgpCiAgICAgICAgc2VsZi5uZXQubGFzdF9saW5lYXIgPSBubi5MaW5lYXIoc2VsZi5uZXQubGFzdF9saW5lYXIuaW5fZmVhdHVyZXMsIG51bV9jbGFzc2VzKQoKICAgIGRlZiBmcmVzaF9wYXJhbXMoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYubmV0Lmxhc3RfbGluZWFyLnBhcmFtZXRlcnMoKQoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHJldHVybiBzZWxmLm5ldCh4KQoKCmNsYXNzIFNFUmVzTmV0MTAxKG5uLk1vZHVsZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbnVtX2NsYXNzZXMsIHByZXRyYWluZWQ9RmFsc2UsIGRyb3BvdXQ9RmFsc2UsIG5ldF9jbHM9Tm9uZSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5uZXQgPSBTRU5ldChTRVJlc05ldEJvdHRsZW5lY2ssIFszLDQsMjMsM10sIGdyb3Vwcz0xLCByZWR1Y3Rpb249MTYsCiAgICAgICAgICAgICAgICAgICAgICAgICBkcm9wb3V0X3A9Tm9uZSwgaW5wbGFuZXM9NjQsIGlucHV0XzN4Mz1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25zYW1wbGVfa2VybmVsX3NpemU9MSwgZG93bnNhbXBsZV9wYWRkaW5nPTAsCiAgICAgICAgICAgICAgICAgICAgICAgICBudW1fY2xhc3Nlcz0xMDAwKQogICAgICAgIHdlaWdodHNfcGF0aCA9IGYnLi4vaW5wdXQvc2VfcmVzbmV0MTAxL3NlX3Jlc25ldDEwMS5wdGgnCiAgICAgICAgc2VsZi5uZXQubG9hZF9zdGF0ZV9kaWN0KHRvcmNoLmxvYWQod2VpZ2h0c19wYXRoKSkKICAgICAgICBzZWxmLm5ldC5hdmdfcG9vbCA9IEF2Z1Bvb2woKQogICAgICAgIHNlbGYubmV0Lmxhc3RfbGluZWFyID0gbm4uTGluZWFyKHNlbGYubmV0Lmxhc3RfbGluZWFyLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKCiAgICBkZWYgZnJlc2hfcGFyYW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLm5ldC5sYXN0X2xpbmVhci5wYXJhbWV0ZXJzKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5uZXQoeCkKCgpjbGFzcyBTRVJlc05ldDE1Mihubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG51bV9jbGFzc2VzLCBwcmV0cmFpbmVkPUZhbHNlLCBkcm9wb3V0PUZhbHNlLCBuZXRfY2xzPU5vbmUpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQogICAgICAgIHNlbGYubmV0ID0gU0VOZXQoU0VSZXNOZXRCb3R0bGVuZWNrLCBbMyw4LDM2LDNdLCBncm91cHM9MSwgcmVkdWN0aW9uPTE2LAogICAgICAgICAgICAgICAgICAgICAgICAgZHJvcG91dF9wPU5vbmUsIGlucGxhbmVzPTY0LCBpbnB1dF8zeDM9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplPTEsIGRvd25zYW1wbGVfcGFkZGluZz0wLAogICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2NsYXNzZXM9MTAwMCkKICAgICAgICB3ZWlnaHRzX3BhdGggPSBmJy4uL2lucHV0L3NlX3Jlc25ldDE1Mi9zZV9yZXNuZXQxNTIucHRoJwogICAgICAgIHNlbGYubmV0LmxvYWRfc3RhdGVfZGljdCh0b3JjaC5sb2FkKHdlaWdodHNfcGF0aCkpCiAgICAgICAgc2VsZi5uZXQuYXZnX3Bvb2wgPSBBdmdQb29sKCkKICAgICAgICBzZWxmLm5ldC5sYXN0X2xpbmVhciA9IG5uLkxpbmVhcihzZWxmLm5ldC5sYXN0X2xpbmVhci5pbl9mZWF0dXJlcywgbnVtX2NsYXNzZXMpCgogICAgZGVmIGZyZXNoX3BhcmFtcyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5uZXQubGFzdF9saW5lYXIucGFyYW1ldGVycygpCgogICAgZGVmIGZvcndhcmQoc2VsZiwgeCk6CiAgICAgICAgcmV0dXJuIHNlbGYubmV0KHgpCgoKY2xhc3MgU0VSZXNOZVh0NTBfMzJ4NGQobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1fY2xhc3NlcywgcHJldHJhaW5lZD1GYWxzZSwgZHJvcG91dD1GYWxzZSwgbmV0X2Nscz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm5ldCA9IFNFTmV0KFNFUmVzTmVYdEJvdHRsZW5lY2ssIFszLDQsNiwzXSwgZ3JvdXBzPTMyLCByZWR1Y3Rpb249MTYsCiAgICAgICAgICAgICAgICAgICAgICAgICBkcm9wb3V0X3A9Tm9uZSwgaW5wbGFuZXM9NjQsIGlucHV0XzN4Mz1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25zYW1wbGVfa2VybmVsX3NpemU9MSwgZG93bnNhbXBsZV9wYWRkaW5nPTAsCiAgICAgICAgICAgICAgICAgICAgICAgICBudW1fY2xhc3Nlcz0xMDAwKQogICAgICAgIHdlaWdodHNfcGF0aCA9IGYnLi4vaW5wdXQvc2VfcmVzbmV4dDUwXzMyeDRkL3NlX3Jlc25leHQ1MF8zMng0ZC5wdGgnCiAgICAgICAgc2VsZi5uZXQubG9hZF9zdGF0ZV9kaWN0KHRvcmNoLmxvYWQod2VpZ2h0c19wYXRoKSkKICAgICAgICBzZWxmLm5ldC5hdmdfcG9vbCA9IEF2Z1Bvb2woKQogICAgICAgIHNlbGYubmV0Lmxhc3RfbGluZWFyID0gbm4uTGluZWFyKHNlbGYubmV0Lmxhc3RfbGluZWFyLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKCiAgICBkZWYgZnJlc2hfcGFyYW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLm5ldC5sYXN0X2xpbmVhci5wYXJhbWV0ZXJzKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5uZXQoeCkKCgpjbGFzcyBTRVJlc05lWHQxMDFfMzJ4NGQobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1fY2xhc3NlcywgcHJldHJhaW5lZD1GYWxzZSwgZHJvcG91dD1GYWxzZSwgbmV0X2Nscz1Ob25lKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm5ldCA9IFNFTmV0KFNFUmVzTmVYdEJvdHRsZW5lY2ssIFszLDQsMjMsM10sIGdyb3Vwcz0zMiwgcmVkdWN0aW9uPTE2LAogICAgICAgICAgICAgICAgICAgICAgICAgZHJvcG91dF9wPU5vbmUsIGlucGxhbmVzPTY0LCBpbnB1dF8zeDM9RmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICBkb3duc2FtcGxlX2tlcm5lbF9zaXplPTEsIGRvd25zYW1wbGVfcGFkZGluZz0wLAogICAgICAgICAgICAgICAgICAgICAgICAgbnVtX2NsYXNzZXM9MTAwMCkKICAgICAgICB3ZWlnaHRzX3BhdGggPSBmJy4uL2lucHV0L3NlX3Jlc25leHQxMDFfMzJ4NGQvc2VfcmVzbmV4dDEwMV8zMng0ZC5wdGgnCiAgICAgICAgc2VsZi5uZXQubG9hZF9zdGF0ZV9kaWN0KHRvcmNoLmxvYWQod2VpZ2h0c19wYXRoKSkKICAgICAgICBzZWxmLm5ldC5hdmdfcG9vbCA9IEF2Z1Bvb2woKQogICAgICAgIHNlbGYubmV0Lmxhc3RfbGluZWFyID0gbm4uTGluZWFyKHNlbGYubmV0Lmxhc3RfbGluZWFyLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKCiAgICBkZWYgZnJlc2hfcGFyYW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLm5ldC5sYXN0X2xpbmVhci5wYXJhbWV0ZXJzKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5uZXQoeCkKCgojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCmNsYXNzIEF2Z1Bvb2wobm4uTW9kdWxlKToKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgpOgogICAgICAgIHJldHVybiBGLmF2Z19wb29sMmQoeCwgeC5zaGFwZVsyOl0pCgoKZGVmIGNyZWF0ZV9uZXQobmV0X2NscywgcHJldHJhaW5lZDogYm9vbCk6CiAgICBpZiBPTl9LQUdHTEUgYW5kIHByZXRyYWluZWQ6CiAgICAgICAgbmV0ID0gbmV0X2NscygpCiAgICAgICAgbW9kZWxfbmFtZSA9IG5ldF9jbHMuX19uYW1lX18KICAgICAgICB3ZWlnaHRzX3BhdGggPSBmJy4uL2lucHV0L3ttb2RlbF9uYW1lfS97bW9kZWxfbmFtZX0ucHRoJwogICAgICAgIG5ldC5sb2FkX3N0YXRlX2RpY3QodG9yY2gubG9hZCh3ZWlnaHRzX3BhdGgpKQogICAgZWxzZToKICAgICAgICBuZXQgPSBuZXRfY2xzKHByZXRyYWluZWQ9cHJldHJhaW5lZCkKICAgIHJldHVybiBuZXQKCgpjbGFzcyBSZXNOZXQobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1fY2xhc3NlcywKICAgICAgICAgICAgICAgICBwcmV0cmFpbmVkPUZhbHNlLCBuZXRfY2xzPU0ucmVzbmV0MTAxLCBkcm9wb3V0PUZhbHNlKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm5ldCA9IGNyZWF0ZV9uZXQobmV0X2NscywgcHJldHJhaW5lZD1wcmV0cmFpbmVkKQogICAgICAgIHNlbGYubmV0LmF2Z3Bvb2wgPSBBdmdQb29sKCkKICAgICAgICBpZiBkcm9wb3V0OgogICAgICAgICAgICBzZWxmLm5ldC5mYyA9IG5uLlNlcXVlbnRpYWwoCiAgICAgICAgICAgICAgICBubi5Ecm9wb3V0KCksCiAgICAgICAgICAgICAgICBubi5MaW5lYXIoc2VsZi5uZXQuZmMuaW5fZmVhdHVyZXMsIG51bV9jbGFzc2VzKSwKICAgICAgICAgICAgKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYubmV0LmZjID0gbm4uTGluZWFyKHNlbGYubmV0LmZjLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKCiAgICBkZWYgZnJlc2hfcGFyYW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLm5ldC5mYy5wYXJhbWV0ZXJzKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5uZXQoeCkKCgpjbGFzcyBJbmNlcHRpb25OZXQobm4uTW9kdWxlKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBudW1fY2xhc3NlcywKICAgICAgICAgICAgICAgICBwcmV0cmFpbmVkPUZhbHNlLCBuZXRfY2xzPU0uaW5jZXB0aW9uX3YzKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLm5ldCA9IGNyZWF0ZV9uZXQobmV0X2NscywgcHJldHJhaW5lZD1wcmV0cmFpbmVkKQogICAgICAgIHNlbGYubmV0LmZjID0gbm4uTGluZWFyKHNlbGYubmV0LmZjLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKICAgICAgICBzZWxmLm5ldC5BdXhMb2dpdHMuZmMgPSBubi5MaW5lYXIoc2VsZi5uZXQuQXV4TG9naXRzLmZjLmluX2ZlYXR1cmVzLCBudW1fY2xhc3NlcykKCiAgICBkZWYgZnJlc2hfcGFyYW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLm5ldC5mYy5wYXJhbWV0ZXJzKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICByZXR1cm4gc2VsZi5uZXQoeCkKCgpjbGFzcyBEZW5zZU5ldChubi5Nb2R1bGUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG51bV9jbGFzc2VzLAogICAgICAgICAgICAgICAgIHByZXRyYWluZWQ9RmFsc2UsIG5ldF9jbHM9TS5kZW5zZW5ldDEyMSk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi5uZXQgPSBjcmVhdGVfbmV0KG5ldF9jbHMsIHByZXRyYWluZWQ9cHJldHJhaW5lZCkKICAgICAgICBzZWxmLmF2Z19wb29sID0gQXZnUG9vbCgpCiAgICAgICAgc2VsZi5uZXQuY2xhc3NpZmllciA9IG5uLkxpbmVhcigKICAgICAgICAgICAgc2VsZi5uZXQuY2xhc3NpZmllci5pbl9mZWF0dXJlcywgbnVtX2NsYXNzZXMpCgogICAgZGVmIGZyZXNoX3BhcmFtcyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5uZXQuY2xhc3NpZmllci5wYXJhbWV0ZXJzKCkKCiAgICBkZWYgZm9yd2FyZChzZWxmLCB4KToKICAgICAgICBvdXQgPSBzZWxmLm5ldC5mZWF0dXJlcyh4KQogICAgICAgIG91dCA9IEYucmVsdShvdXQsIGlucGxhY2U9VHJ1ZSkKICAgICAgICBvdXQgPSBzZWxmLmF2Z19wb29sKG91dCkudmlldyhvdXQuc2l6ZSgwKSwgLTEpCiAgICAgICAgb3V0ID0gc2VsZi5uZXQuY2xhc3NpZmllcihvdXQpCiAgICAgICAgcmV0dXJuIG91dAoKCnJlc25ldDE4ID0gcGFydGlhbChSZXNOZXQsIG5ldF9jbHM9TS5yZXNuZXQxOCkKcmVzbmV0MzQgPSBwYXJ0aWFsKFJlc05ldCwgbmV0X2Nscz1NLnJlc25ldDM0KQpyZXNuZXQ1MCA9IHBhcnRpYWwoUmVzTmV0LCBuZXRfY2xzPU0ucmVzbmV0NTApCnJlc25ldDEwMSA9IHBhcnRpYWwoUmVzTmV0LCBuZXRfY2xzPU0ucmVzbmV0MTAxKQpyZXNuZXQxNTIgPSBwYXJ0aWFsKFJlc05ldCwgbmV0X2Nscz1NLnJlc25ldDE1MikKCmRlbnNlbmV0MTIxID0gcGFydGlhbChEZW5zZU5ldCwgbmV0X2Nscz1NLmRlbnNlbmV0MTIxKQpkZW5zZW5ldDE2OSA9IHBhcnRpYWwoRGVuc2VOZXQsIG5ldF9jbHM9TS5kZW5zZW5ldDE2OSkKZGVuc2VuZXQyMDEgPSBwYXJ0aWFsKERlbnNlTmV0LCBuZXRfY2xzPU0uZGVuc2VuZXQyMDEpCmRlbnNlbmV0MTYxID0gcGFydGlhbChEZW5zZU5ldCwgbmV0X2Nscz1NLmRlbnNlbmV0MTYxKQoKaW5jZXB0aW9uX3YzID0gcGFydGlhbChJbmNlcHRpb25OZXQsIG5ldF9jbHM9TS5pbmNlcHRpb25fdjMpCgpzZV9yZXNuZXQ1MCA9IHBhcnRpYWwoU0VSZXNOZXQ1MCwgbmV0X2Nscz1Ob25lKQpzZV9yZXNuZXQxMDEgPSBwYXJ0aWFsKFNFUmVzTmV0MTAxLCBuZXRfY2xzPU5vbmUpCnNlX3Jlc25ldDE1MiA9IHBhcnRpYWwoU0VSZXNOZXQxNTIsIG5ldF9jbHM9Tm9uZSkKCnNlX3Jlc25leHQ1MF8zMng0ZCA9IHBhcnRpYWwoU0VSZXNOZVh0NTBfMzJ4NGQsIG5ldF9jbHM9Tm9uZSkKc2VfcmVzbmV4dDEwMV8zMng0ZCA9IHBhcnRpYWwoU0VSZXNOZVh0MTAxXzMyeDRkLCBuZXRfY2xzPU5vbmUpCg==',
                    'imet/__init__.py': 'aW1wb3J0IGN2MgoKCmN2Mi5zZXROdW1UaHJlYWRzKDApICAjIGZpeCBwb3RlbnRpYWwgcHl0b3JjaCB3b3JrZXIgaXNzdWVzCg==',
                    # possibly set seed
                    'imet/make_folds.py': 'aW1wb3J0IGFyZ3BhcnNlCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IGRlZmF1bHRkaWN0LCBDb3VudGVyCmltcG9ydCByYW5kb20KCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHRxZG0KCmZyb20gLmRhdGFzZXQgaW1wb3J0IERBVEFfUk9PVAoKCmRlZiBtYWtlX2ZvbGRzKG5fZm9sZHM6IGludCwgc2VlZDogaW50KSAtPiBwZC5EYXRhRnJhbWU6CiAgICBkZiA9IHBkLnJlYWRfY3N2KERBVEFfUk9PVCAvICd0cmFpbi5jc3YnKQogICAgY2xzX2NvdW50cyA9IENvdW50ZXIoY2xzIGZvciBjbGFzc2VzIGluIGRmWydhdHRyaWJ1dGVfaWRzJ10uc3RyLnNwbGl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBjbHMgaW4gY2xhc3NlcykKICAgIGZvbGRfY2xzX2NvdW50cyA9IGRlZmF1bHRkaWN0KGludCkKICAgIGZvbGRzID0gWy0xXSAqIGxlbihkZikKICAgIGZvciBpdGVtIGluIHRxZG0udHFkbShkZi5zYW1wbGUoZnJhYz0xLCByYW5kb21fc3RhdGU9c2VlZCkuaXRlcnR1cGxlcygpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsPWxlbihkZikpOgogICAgICAgIGNscyA9IG1pbihpdGVtLmF0dHJpYnV0ZV9pZHMuc3BsaXQoKSwga2V5PWxhbWJkYSBjbHM6IGNsc19jb3VudHNbY2xzXSkKICAgICAgICBmb2xkX2NvdW50cyA9IFsoZiwgZm9sZF9jbHNfY291bnRzW2YsIGNsc10pIGZvciBmIGluIHJhbmdlKG5fZm9sZHMpXQogICAgICAgIG1pbl9jb3VudCA9IG1pbihbY291bnQgZm9yIF8sIGNvdW50IGluIGZvbGRfY291bnRzXSkKICAgICAgICByYW5kb20uc2VlZChpdGVtLkluZGV4KQogICAgICAgIGZvbGQgPSByYW5kb20uY2hvaWNlKFtmIGZvciBmLCBjb3VudCBpbiBmb2xkX2NvdW50cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjb3VudCA9PSBtaW5fY291bnRdKQogICAgICAgIGZvbGRzW2l0ZW0uSW5kZXhdID0gZm9sZAogICAgICAgIGZvciBjbHMgaW4gaXRlbS5hdHRyaWJ1dGVfaWRzLnNwbGl0KCk6CiAgICAgICAgICAgIGZvbGRfY2xzX2NvdW50c1tmb2xkLCBjbHNdICs9IDEKICAgIGRmWydmb2xkJ10gPSBmb2xkcwogICAgcmV0dXJuIGRmCgoKZGVmIG1haW4oKToKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKCkKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoJy0tbi1mb2xkcycsIHR5cGU9aW50LCBkZWZhdWx0PTUpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCctLXNlZWQnLCB0eXBlPWludCwgZGVmYXVsdD00MikKICAgIGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCiAgICBkZiA9IG1ha2VfZm9sZHMobl9mb2xkcz1hcmdzLm5fZm9sZHMsIHNlZWQ9YXJncy5zZWVkKQogICAgZGYudG9fY3N2KCdmb2xkcy5jc3YnLCBpbmRleD1Ob25lKQoKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCk=',
                    'imet/dataset.py': 'ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gdHlwaW5nIGltcG9ydCBDYWxsYWJsZSwgTGlzdAoKaW1wb3J0IGN2MgppbXBvcnQgcGFuZGFzIGFzIHBkCmZyb20gUElMIGltcG9ydCBJbWFnZQppbXBvcnQgdG9yY2gKZnJvbSB0b3JjaC51dGlscy5kYXRhIGltcG9ydCBEYXRhc2V0Cgpmcm9tIC50cmFuc2Zvcm1zIGltcG9ydCB0ZW5zb3JfdHJhbnNmb3JtCmZyb20gLnV0aWxzIGltcG9ydCBPTl9LQUdHTEUKCgpOX0NMQVNTRVMgPSAxMTAzCkRBVEFfUk9PVCA9IFBhdGgoJy4uL2lucHV0L2ltZXQtMjAxOS1mZ3ZjNicgaWYgT05fS0FHR0xFIGVsc2UgJy4vZGF0YScpCgoKY2xhc3MgVHJhaW5EYXRhc2V0KERhdGFzZXQpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHJvb3Q6IFBhdGgsIGRmOiBwZC5EYXRhRnJhbWUsCiAgICAgICAgICAgICAgICAgaW1hZ2VfdHJhbnNmb3JtOiBDYWxsYWJsZSwgZGVidWc6IGJvb2wgPSBUcnVlKToKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKICAgICAgICBzZWxmLl9yb290ID0gcm9vdAogICAgICAgIHNlbGYuX2RmID0gZGYKICAgICAgICBzZWxmLl9pbWFnZV90cmFuc2Zvcm0gPSBpbWFnZV90cmFuc2Zvcm0KICAgICAgICBzZWxmLl9kZWJ1ZyA9IGRlYnVnCgogICAgZGVmIF9fbGVuX18oc2VsZik6CiAgICAgICAgcmV0dXJuIGxlbihzZWxmLl9kZikKCiAgICBkZWYgX19nZXRpdGVtX18oc2VsZiwgaWR4OiBpbnQpOgogICAgICAgIGl0ZW0gPSBzZWxmLl9kZi5pbG9jW2lkeF0KICAgICAgICBpbWFnZSA9IGxvYWRfdHJhbnNmb3JtX2ltYWdlKAogICAgICAgICAgICBpdGVtLCBzZWxmLl9yb290LCBzZWxmLl9pbWFnZV90cmFuc2Zvcm0sIGRlYnVnPXNlbGYuX2RlYnVnKQogICAgICAgIHRhcmdldCA9IHRvcmNoLnplcm9zKE5fQ0xBU1NFUykKICAgICAgICBmb3IgY2xzIGluIGl0ZW0uYXR0cmlidXRlX2lkcy5zcGxpdCgpOgogICAgICAgICAgICB0YXJnZXRbaW50KGNscyldID0gMQogICAgICAgIHJldHVybiBpbWFnZSwgdGFyZ2V0CgoKY2xhc3MgVFRBRGF0YXNldDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCByb290OiBQYXRoLCBkZjogcGQuRGF0YUZyYW1lLAogICAgICAgICAgICAgICAgIGltYWdlX3RyYW5zZm9ybTogQ2FsbGFibGUsIHR0YTogaW50KToKICAgICAgICBzZWxmLl9yb290ID0gcm9vdAogICAgICAgIHNlbGYuX2RmID0gZGYKICAgICAgICBzZWxmLl9pbWFnZV90cmFuc2Zvcm0gPSBpbWFnZV90cmFuc2Zvcm0KICAgICAgICBzZWxmLl90dGEgPSB0dGEKCiAgICBkZWYgX19sZW5fXyhzZWxmKToKICAgICAgICByZXR1cm4gbGVuKHNlbGYuX2RmKSAqIHNlbGYuX3R0YQoKICAgIGRlZiBfX2dldGl0ZW1fXyhzZWxmLCBpZHgpOgogICAgICAgIGl0ZW0gPSBzZWxmLl9kZi5pbG9jW2lkeCAlIGxlbihzZWxmLl9kZildCiAgICAgICAgaW1hZ2UgPSBsb2FkX3RyYW5zZm9ybV9pbWFnZShpdGVtLCBzZWxmLl9yb290LCBzZWxmLl9pbWFnZV90cmFuc2Zvcm0pCiAgICAgICAgcmV0dXJuIGltYWdlLCBpdGVtLmlkCgoKZGVmIGxvYWRfdHJhbnNmb3JtX2ltYWdlKAogICAgICAgIGl0ZW0sIHJvb3Q6IFBhdGgsIGltYWdlX3RyYW5zZm9ybTogQ2FsbGFibGUsIGRlYnVnOiBib29sID0gRmFsc2UpOgogICAgaW1hZ2UgPSBsb2FkX2ltYWdlKGl0ZW0sIHJvb3QpCiAgICBpbWFnZSA9IGltYWdlX3RyYW5zZm9ybShpbWFnZSkKICAgIGlmIGRlYnVnOgogICAgICAgIGltYWdlLnNhdmUoJ19kZWJ1Zy5wbmcnKQogICAgcmV0dXJuIHRlbnNvcl90cmFuc2Zvcm0oaW1hZ2UpCgoKZGVmIGxvYWRfaW1hZ2UoaXRlbSwgcm9vdDogUGF0aCkgLT4gSW1hZ2UuSW1hZ2U6CiAgICBpbWFnZSA9IGN2Mi5pbXJlYWQoc3RyKHJvb3QgLyBmJ3tpdGVtLmlkfS5wbmcnKSkKICAgIGltYWdlID0gY3YyLmN2dENvbG9yKGltYWdlLCBjdjIuQ09MT1JfQkdSMlJHQikKICAgIHJldHVybiBJbWFnZS5mcm9tYXJyYXkoaW1hZ2UpCgoKZGVmIGdldF9pZHMocm9vdDogUGF0aCkgLT4gTGlzdFtzdHJdOgogICAgcmV0dXJuIHNvcnRlZCh7cC5uYW1lLnNwbGl0KCdfJylbMF0gZm9yIHAgaW4gcm9vdC5nbG9iKCcqLnBuZycpfSkK',
                    'imet/utils.py': 'ZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGpzb24KaW1wb3J0IGdsb2IKaW1wb3J0IG9zCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aApmcm9tIG11bHRpcHJvY2Vzc2luZy5wb29sIGltcG9ydCBUaHJlYWRQb29sCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0CgppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHBhbmRhcyBhcyBwZApmcm9tIHNjaXB5LnN0YXRzLm1zdGF0cyBpbXBvcnQgZ21lYW4KaW1wb3J0IHRvcmNoCmZyb20gdG9yY2ggaW1wb3J0IG5uCmZyb20gdG9yY2gudXRpbHMuZGF0YSBpbXBvcnQgRGF0YUxvYWRlcgoKCk9OX0tBR0dMRTogYm9vbCA9ICdLQUdHTEVfV09SS0lOR19ESVInIGluIG9zLmVudmlyb24KCgpkZWYgZ21lYW5fZGYoZGY6IHBkLkRhdGFGcmFtZSkgLT4gcGQuRGF0YUZyYW1lOgogICAgcmV0dXJuIGRmLmdyb3VwYnkobGV2ZWw9MCkuYWdnKGxhbWJkYSB4OiBnbWVhbihsaXN0KHgpKSkKCgpkZWYgbWVhbl9kZihkZjogcGQuRGF0YUZyYW1lKSAtPiBwZC5EYXRhRnJhbWU6CiAgICByZXR1cm4gZGYuZ3JvdXBieShsZXZlbD0wKS5tZWFuKCkKCgpkZWYgbG9hZF9tb2RlbChtb2RlbDogbm4uTW9kdWxlLCBwYXRoOiBQYXRoKSAtPiBEaWN0OgogICAgc3RhdGUgPSB0b3JjaC5sb2FkKHN0cihwYXRoKSkKICAgIG1vZGVsLmxvYWRfc3RhdGVfZGljdChzdGF0ZVsnbW9kZWwnXSkKICAgIHByaW50KCdMb2FkZWQgbW9kZWwgZnJvbSBlcG9jaCB7ZXBvY2h9LCBzdGVwIHtzdGVwOix9Jy5mb3JtYXQoKipzdGF0ZSkpCiAgICByZXR1cm4gc3RhdGUKCgpjbGFzcyBUaHJlYWRpbmdEYXRhTG9hZGVyKERhdGFMb2FkZXIpOgogICAgZGVmIF9faXRlcl9fKHNlbGYpOgogICAgICAgIHNhbXBsZV9pdGVyID0gaXRlcihzZWxmLmJhdGNoX3NhbXBsZXIpCiAgICAgICAgaWYgc2VsZi5udW1fd29ya2VycyA9PSAwOgogICAgICAgICAgICBmb3IgaW5kaWNlcyBpbiBzYW1wbGVfaXRlcjoKICAgICAgICAgICAgICAgIHlpZWxkIHNlbGYuY29sbGF0ZV9mbihbc2VsZi5fZ2V0X2l0ZW0oaSkgZm9yIGkgaW4gaW5kaWNlc10pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJlZmV0Y2ggPSAxCiAgICAgICAgICAgIHdpdGggVGhyZWFkUG9vbChwcm9jZXNzZXM9c2VsZi5udW1fd29ya2VycykgYXMgcG9vbDoKICAgICAgICAgICAgICAgIGZ1dHVyZXMgPSBbXQogICAgICAgICAgICAgICAgZm9yIGluZGljZXMgaW4gc2FtcGxlX2l0ZXI6CiAgICAgICAgICAgICAgICAgICAgZnV0dXJlcy5hcHBlbmQoW3Bvb2wuYXBwbHlfYXN5bmMoc2VsZi5fZ2V0X2l0ZW0sIGFyZ3M9KGksKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaW5kaWNlc10pCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGZ1dHVyZXMpID4gcHJlZmV0Y2g6CiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHNlbGYuY29sbGF0ZV9mbihbZi5nZXQoKSBmb3IgZiBpbiBmdXR1cmVzLnBvcCgwKV0pCiAgICAgICAgICAgICAgICAgICAgIyBpdGVtcyA9IHBvb2wubWFwKGxhbWJkYSBpOiBzZWxmLmRhdGFzZXRbaV0sIGluZGljZXMpCiAgICAgICAgICAgICAgICAgICAgIyB5aWVsZCBzZWxmLmNvbGxhdGVfZm4oaXRlbXMpCiAgICAgICAgICAgICAgICBmb3IgYmF0Y2hfZnV0dXJlcyBpbiBmdXR1cmVzOgogICAgICAgICAgICAgICAgICAgIHlpZWxkIHNlbGYuY29sbGF0ZV9mbihbZi5nZXQoKSBmb3IgZiBpbiBiYXRjaF9mdXR1cmVzXSkKCiAgICBkZWYgX2dldF9pdGVtKHNlbGYsIGkpOgogICAgICAgIHJldHVybiBzZWxmLmRhdGFzZXRbaV0KCgpkZWYgd3JpdGVfZXZlbnQobG9nLCBzdGVwOiBpbnQsICoqZGF0YSk6CiAgICBkYXRhWydzdGVwJ10gPSBzdGVwCiAgICBkYXRhWydkdCddID0gZGF0ZXRpbWUubm93KCkuaXNvZm9ybWF0KCkKICAgIGxvZy53cml0ZShqc29uLmR1bXBzKGRhdGEsIHNvcnRfa2V5cz1UcnVlKSkKICAgIGxvZy53cml0ZSgnXG4nKQogICAgbG9nLmZsdXNoKCkKCgpkZWYgcGxvdCgqYXJncywgeW1pbj1Ob25lLCB5bWF4PU5vbmUsIHhtaW49Tm9uZSwgeG1heD1Ob25lLCBwYXJhbXM9RmFsc2UsCiAgICAgICAgIG1heF9wb2ludHM9MjAwLCBsZWdlbmQ9VHJ1ZSwgdGl0bGU9Tm9uZSwKICAgICAgICAgcHJpbnRfa2V5cz1GYWxzZSwgcHJpbnRfcGF0aHM9RmFsc2UsIHBsdD1Ob25lLCBuZXdmaWd1cmU9VHJ1ZSwKICAgICAgICAgeF9zY2FsZT0xKToKICAgICIiIgogICAgVXNlIGluIHRoZSBub3RlYm9vayBsaWtlIHRoaXM6OgoKICAgICAgICAlbWF0cGxvdGxpYiBpbmxpbmUKICAgICAgICBmcm9tIGltZXQudXRpbHMgaW1wb3J0IHBsb3QKICAgICAgICBwbG90KCcuL3J1bnMvb2MyJywgJy4vcnVucy9vYzEnLCAnbG9zcycsICd2YWxpZF9sb3NzJykKCiAgICAiIiIKICAgIGltcG9ydCBqc29uX2xpbmVzICAjIG5vIGF2YWlsYWJsZSBvbiBLYWdnbGUKCiAgICBpZiBwbHQgaXMgTm9uZToKICAgICAgICBmcm9tIG1hdHBsb3RsaWIgaW1wb3J0IHB5cGxvdCBhcyBwbHQKICAgIHBhdGhzLCBrZXlzID0gW10sIFtdCiAgICBmb3IgeCBpbiBhcmdzOgogICAgICAgIGlmIHguc3RhcnRzd2l0aCgnLicpIG9yICcvJyBpbiB4OgogICAgICAgICAgICBpZiAnKicgaW4geDoKICAgICAgICAgICAgICAgIHBhdGhzLmV4dGVuZChnbG9iLmdsb2IoeCkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXRocy5hcHBlbmQoeCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBrZXlzLmFwcGVuZCh4KQogICAgaWYgcHJpbnRfcGF0aHM6CiAgICAgICAgcHJpbnQoJ0ZvdW5kIHBhdGhzOiB7fScuZm9ybWF0KCcgJy5qb2luKHNvcnRlZChwYXRocykpKSkKICAgIGlmIG5ld2ZpZ3VyZToKICAgICAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDEyLCA4KSkKICAgIGtleXMgPSBrZXlzIG9yIFsnbG9zcycsICd2YWxpZF9sb3NzJ10KCiAgICB5bGltX2t3ID0ge30KICAgIGlmIHltaW4gaXMgbm90IE5vbmU6CiAgICAgICAgeWxpbV9rd1snYm90dG9tJ10gPSB5bWluCiAgICBpZiB5bWF4IGlzIG5vdCBOb25lOgogICAgICAgIHlsaW1fa3dbJ3RvcCddID0geW1heAogICAgaWYgeWxpbV9rdzoKICAgICAgICBwbHQueWxpbSgqKnlsaW1fa3cpCgogICAgeGxpbV9rdyA9IHt9CiAgICBpZiB4bWluIGlzIG5vdCBOb25lOgogICAgICAgIHhsaW1fa3dbJ2xlZnQnXSA9IHhtaW4KICAgIGlmIHhtYXggaXMgbm90IE5vbmU6CiAgICAgICAgeGxpbV9rd1sncmlnaHQnXSA9IHhtYXgKICAgIGlmIHhsaW1fa3c6CiAgICAgICAgcGx0LnhsaW0oKip4bGltX2t3KQogICAgYWxsX2tleXMgPSBzZXQoKQogICAgZm9yIHBhdGggaW4gc29ydGVkKHBhdGhzKToKICAgICAgICBwYXRoID0gUGF0aChwYXRoKQogICAgICAgIHdpdGgganNvbl9saW5lcy5vcGVuKHBhdGggLyAndHJhaW4ubG9nJywgYnJva2VuPVRydWUpIGFzIGY6CiAgICAgICAgICAgIGV2ZW50cyA9IGxpc3QoZikKICAgICAgICBhbGxfa2V5cy51cGRhdGUoayBmb3IgZSBpbiBldmVudHMgZm9yIGsgaW4gZSkKICAgICAgICBmb3Iga2V5IGluIHNvcnRlZChrZXlzKToKICAgICAgICAgICAgeHMsIHlzLCB5c19lcnIgPSBbXSwgW10sIFtdCiAgICAgICAgICAgIGZvciBlIGluIGV2ZW50czoKICAgICAgICAgICAgICAgIGlmIGtleSBpbiBlOgogICAgICAgICAgICAgICAgICAgIHhzLmFwcGVuZChlWydzdGVwJ10gKiB4X3NjYWxlKQogICAgICAgICAgICAgICAgICAgIHlzLmFwcGVuZChlW2tleV0pCiAgICAgICAgICAgICAgICAgICAgc3RkX2tleSA9IGtleSArICdfc3RkJwogICAgICAgICAgICAgICAgICAgIGlmIHN0ZF9rZXkgaW4gZToKICAgICAgICAgICAgICAgICAgICAgICAgeXNfZXJyLmFwcGVuZChlW3N0ZF9rZXldKQogICAgICAgICAgICBpZiB4czoKICAgICAgICAgICAgICAgIGlmIG5wLmlzbmFuKHlzKS5hbnkoKToKICAgICAgICAgICAgICAgICAgICBwcmludCgnV2FybmluZzogTmFOIHt9IGZvciB7fScuZm9ybWF0KGtleSwgcGF0aCkpCiAgICAgICAgICAgICAgICBpZiBsZW4oeHMpID4gMiAqIG1heF9wb2ludHM6CiAgICAgICAgICAgICAgICAgICAgaW5kaWNlcyA9IChucC5hcmFuZ2UoMCwgbGVuKHhzKSAtIDEsIGxlbih4cykgLyBtYXhfcG9pbnRzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFzdHlwZShucC5pbnQzMikpCiAgICAgICAgICAgICAgICAgICAgeHMgPSBucC5hcnJheSh4cylbaW5kaWNlc1sxOl1dCiAgICAgICAgICAgICAgICAgICAgeXMgPSBfc21vb3RoKHlzLCBpbmRpY2VzKQogICAgICAgICAgICAgICAgICAgIGlmIHlzX2VycjoKICAgICAgICAgICAgICAgICAgICAgICAgeXNfZXJyID0gX3Ntb290aCh5c19lcnIsIGluZGljZXMpCiAgICAgICAgICAgICAgICBsYWJlbCA9ICd7fToge30nLmZvcm1hdChwYXRoLCBrZXkpCiAgICAgICAgICAgICAgICBpZiBsYWJlbC5zdGFydHN3aXRoKCdfJyk6CiAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAnICcgKyBsYWJlbAogICAgICAgICAgICAgICAgaWYgeXNfZXJyOgogICAgICAgICAgICAgICAgICAgIHlzX2VyciA9IDEuOTYgKiBucC5hcnJheSh5c19lcnIpCiAgICAgICAgICAgICAgICAgICAgcGx0LmVycm9yYmFyKHhzLCB5cywgeWVycj15c19lcnIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtdD0nLW8nLCBjYXBzaXplPTUsIGNhcHRoaWNrPTIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPWxhYmVsKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwbHQucGxvdCh4cywgeXMsIGxhYmVsPWxhYmVsKQogICAgICAgICAgICAgICAgcGx0LmxlZ2VuZCgpCiAgICBpZiBuZXdmaWd1cmU6CiAgICAgICAgcGx0LmdyaWQoKQogICAgaWYgbGVnZW5kOgogICAgICAgIHBsdC5sZWdlbmQoKQogICAgaWYgdGl0bGU6CiAgICAgICAgcGx0LnRpdGxlKHRpdGxlKQogICAgaWYgcHJpbnRfa2V5czoKICAgICAgICBwcmludCgnRm91bmQga2V5czoge30nCiAgICAgICAgICAgICAgLmZvcm1hdCgnLCAnLmpvaW4oc29ydGVkKGFsbF9rZXlzIC0geydzdGVwJywgJ2R0J30pKSkpCgoKZGVmIF9zbW9vdGgoeXMsIGluZGljZXMpOgogICAgcmV0dXJuIFtucC5tZWFuKHlzW2lkeDogaW5kaWNlc1tpICsgMV1dKQogICAgICAgICAgICBmb3IgaSwgaWR4IGluIGVudW1lcmF0ZShpbmRpY2VzWzotMV0pXQo=',
                    # save best f2
                    'imet/main.py': 'aW1wb3J0IGFyZ3BhcnNlCmZyb20gaXRlcnRvb2xzIGltcG9ydCBpc2xpY2UKaW1wb3J0IGpzb24KZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmltcG9ydCBzaHV0aWwKaW1wb3J0IHdhcm5pbmdzCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0CgppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHBhbmRhcyBhcyBwZApmcm9tIHNrbGVhcm4ubWV0cmljcyBpbXBvcnQgZmJldGFfc2NvcmUKZnJvbSBza2xlYXJuLmV4Y2VwdGlvbnMgaW1wb3J0IFVuZGVmaW5lZE1ldHJpY1dhcm5pbmcKaW1wb3J0IHRvcmNoCmZyb20gdG9yY2ggaW1wb3J0IG5uLCBjdWRhCmZyb20gdG9yY2gub3B0aW0gaW1wb3J0IEFkYW0KaW1wb3J0IHRxZG0KCmZyb20gLiBpbXBvcnQgbW9kZWxzCmZyb20gLmRhdGFzZXQgaW1wb3J0IFRyYWluRGF0YXNldCwgVFRBRGF0YXNldCwgZ2V0X2lkcywgTl9DTEFTU0VTLCBEQVRBX1JPT1QKZnJvbSAudHJhbnNmb3JtcyBpbXBvcnQgdHJhaW5fdHJhbnNmb3JtLCB0ZXN0X3RyYW5zZm9ybQpmcm9tIC51dGlscyBpbXBvcnQgKAogICAgd3JpdGVfZXZlbnQsIGxvYWRfbW9kZWwsIG1lYW5fZGYsIFRocmVhZGluZ0RhdGFMb2FkZXIgYXMgRGF0YUxvYWRlciwKICAgIE9OX0tBR0dMRSkKCgpkZWYgbWFpbigpOgogICAgcGFyc2VyID0gYXJncGFyc2UuQXJndW1lbnRQYXJzZXIoKQogICAgYXJnID0gcGFyc2VyLmFkZF9hcmd1bWVudAogICAgYXJnKCdtb2RlJywgY2hvaWNlcz1bJ3RyYWluJywgJ3ZhbGlkYXRlJywgJ3ByZWRpY3RfdmFsaWQnLCAncHJlZGljdF90ZXN0J10pCiAgICBhcmcoJ3J1bl9yb290JykKICAgIGFyZygnLS1tb2RlbCcsIGRlZmF1bHQ9J3Jlc25ldDEwMScpCiAgICBhcmcoJy0tcHJldHJhaW5lZCcsIHR5cGU9aW50LCBkZWZhdWx0PTEpCiAgICBhcmcoJy0tYmF0Y2gtc2l6ZScsIHR5cGU9aW50LCBkZWZhdWx0PTY0KQogICAgYXJnKCctLXN0ZXAnLCB0eXBlPWludCwgZGVmYXVsdD0xKQogICAgYXJnKCctLXdvcmtlcnMnLCB0eXBlPWludCwgZGVmYXVsdD0yIGlmIE9OX0tBR0dMRSBlbHNlIDQpCiAgICBhcmcoJy0tbHInLCB0eXBlPWZsb2F0LCBkZWZhdWx0PTFlLTQpCiAgICBhcmcoJy0tcGF0aWVuY2UnLCB0eXBlPWludCwgZGVmYXVsdD00KQogICAgYXJnKCctLWNsZWFuJywgYWN0aW9uPSdzdG9yZV90cnVlJykKICAgIGFyZygnLS1uLWVwb2NocycsIHR5cGU9aW50LCBkZWZhdWx0PTEwMCkKICAgIGFyZygnLS1lcG9jaC1zaXplJywgdHlwZT1pbnQpCiAgICBhcmcoJy0tdHRhJywgdHlwZT1pbnQsIGRlZmF1bHQ9NCkKICAgIGFyZygnLS11c2Utc2FtcGxlJywgYWN0aW9uPSdzdG9yZV90cnVlJywgaGVscD0ndXNlIGEgc2FtcGxlIG9mIHRoZSBkYXRhc2V0JykKICAgIGFyZygnLS1kZWJ1ZycsIGFjdGlvbj0nc3RvcmVfdHJ1ZScpCiAgICBhcmcoJy0tbGltaXQnLCB0eXBlPWludCkKICAgIGFyZygnLS1mb2xkJywgdHlwZT1pbnQsIGRlZmF1bHQ9MCkKICAgIGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCgogICAgcnVuX3Jvb3QgPSBQYXRoKGFyZ3MucnVuX3Jvb3QpCiAgICBmb2xkcyA9IHBkLnJlYWRfY3N2KCdmb2xkcy5jc3YnKQogICAgdHJhaW5fcm9vdCA9IERBVEFfUk9PVCAvICgndHJhaW5fc2FtcGxlJyBpZiBhcmdzLnVzZV9zYW1wbGUgZWxzZSAndHJhaW4nKQogICAgaWYgYXJncy51c2Vfc2FtcGxlOgogICAgICAgIGZvbGRzID0gZm9sZHNbZm9sZHNbJ0lkJ10uaXNpbihzZXQoZ2V0X2lkcyh0cmFpbl9yb290KSkpXQogICAgdHJhaW5fZm9sZCA9IGZvbGRzW2ZvbGRzWydmb2xkJ10gIT0gYXJncy5mb2xkXQogICAgdmFsaWRfZm9sZCA9IGZvbGRzW2ZvbGRzWydmb2xkJ10gPT0gYXJncy5mb2xkXQogICAgaWYgYXJncy5saW1pdDoKICAgICAgICB0cmFpbl9mb2xkID0gdHJhaW5fZm9sZFs6YXJncy5saW1pdF0KICAgICAgICB2YWxpZF9mb2xkID0gdmFsaWRfZm9sZFs6YXJncy5saW1pdF0KCiAgICBkZWYgbWFrZV9sb2FkZXIoZGY6IHBkLkRhdGFGcmFtZSwgaW1hZ2VfdHJhbnNmb3JtKSAtPiBEYXRhTG9hZGVyOgogICAgICAgIHJldHVybiBEYXRhTG9hZGVyKAogICAgICAgICAgICBUcmFpbkRhdGFzZXQodHJhaW5fcm9vdCwgZGYsIGltYWdlX3RyYW5zZm9ybSwgZGVidWc9YXJncy5kZWJ1ZyksCiAgICAgICAgICAgIHNodWZmbGU9VHJ1ZSwKICAgICAgICAgICAgYmF0Y2hfc2l6ZT1hcmdzLmJhdGNoX3NpemUsCiAgICAgICAgICAgIG51bV93b3JrZXJzPWFyZ3Mud29ya2VycywKICAgICAgICApCiAgICBjcml0ZXJpb24gPSBubi5CQ0VXaXRoTG9naXRzTG9zcyhyZWR1Y3Rpb249J25vbmUnKQogICAgbW9kZWwgPSBnZXRhdHRyKG1vZGVscywgYXJncy5tb2RlbCkoCiAgICAgICAgbnVtX2NsYXNzZXM9Tl9DTEFTU0VTLCBwcmV0cmFpbmVkPWFyZ3MucHJldHJhaW5lZCkKICAgIHVzZV9jdWRhID0gY3VkYS5pc19hdmFpbGFibGUoKQogICAgZnJlc2hfcGFyYW1zID0gbGlzdChtb2RlbC5mcmVzaF9wYXJhbXMoKSkKICAgIGFsbF9wYXJhbXMgPSBsaXN0KG1vZGVsLnBhcmFtZXRlcnMoKSkKICAgIGlmIHVzZV9jdWRhOgogICAgICAgIG1vZGVsID0gbW9kZWwuY3VkYSgpCgogICAgaWYgYXJncy5tb2RlID09ICd0cmFpbic6CiAgICAgICAgaWYgcnVuX3Jvb3QuZXhpc3RzKCkgYW5kIGFyZ3MuY2xlYW46CiAgICAgICAgICAgIHNodXRpbC5ybXRyZWUocnVuX3Jvb3QpCiAgICAgICAgcnVuX3Jvb3QubWtkaXIoZXhpc3Rfb2s9VHJ1ZSwgcGFyZW50cz1UcnVlKQogICAgICAgIChydW5fcm9vdCAvICdwYXJhbXMuanNvbicpLndyaXRlX3RleHQoCiAgICAgICAgICAgIGpzb24uZHVtcHModmFycyhhcmdzKSwgaW5kZW50PTQsIHNvcnRfa2V5cz1UcnVlKSkKCiAgICAgICAgdHJhaW5fbG9hZGVyID0gbWFrZV9sb2FkZXIodHJhaW5fZm9sZCwgdHJhaW5fdHJhbnNmb3JtKQogICAgICAgIHZhbGlkX2xvYWRlciA9IG1ha2VfbG9hZGVyKHZhbGlkX2ZvbGQsIHRlc3RfdHJhbnNmb3JtKQogICAgICAgIHByaW50KGYne2xlbih0cmFpbl9sb2FkZXIuZGF0YXNldCk6LH0gaXRlbXMgaW4gdHJhaW4sICcKICAgICAgICAgICAgICBmJ3tsZW4odmFsaWRfbG9hZGVyLmRhdGFzZXQpOix9IGluIHZhbGlkJykKCiAgICAgICAgdHJhaW5fa3dhcmdzID0gZGljdCgKICAgICAgICAgICAgYXJncz1hcmdzLAogICAgICAgICAgICBtb2RlbD1tb2RlbCwKICAgICAgICAgICAgY3JpdGVyaW9uPWNyaXRlcmlvbiwKICAgICAgICAgICAgdHJhaW5fbG9hZGVyPXRyYWluX2xvYWRlciwKICAgICAgICAgICAgdmFsaWRfbG9hZGVyPXZhbGlkX2xvYWRlciwKICAgICAgICAgICAgcGF0aWVuY2U9YXJncy5wYXRpZW5jZSwKICAgICAgICAgICAgaW5pdF9vcHRpbWl6ZXI9bGFtYmRhIHBhcmFtcywgbHI6IEFkYW0ocGFyYW1zLCBsciksCiAgICAgICAgICAgIHVzZV9jdWRhPXVzZV9jdWRhLAogICAgICAgICkKCiAgICAgICAgaWYgYXJncy5wcmV0cmFpbmVkOgogICAgICAgICAgICBpZiB0cmFpbihwYXJhbXM9ZnJlc2hfcGFyYW1zLCBuX2Vwb2Nocz0xLCAqKnRyYWluX2t3YXJncyk6CiAgICAgICAgICAgICAgICB0cmFpbihwYXJhbXM9YWxsX3BhcmFtcywgKip0cmFpbl9rd2FyZ3MpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdHJhaW4ocGFyYW1zPWFsbF9wYXJhbXMsICoqdHJhaW5fa3dhcmdzKQoKICAgIGVsaWYgYXJncy5tb2RlID09ICd2YWxpZGF0ZSc6CiAgICAgICAgdmFsaWRfbG9hZGVyID0gbWFrZV9sb2FkZXIodmFsaWRfZm9sZCwgdGVzdF90cmFuc2Zvcm0pCiAgICAgICAgbG9hZF9tb2RlbChtb2RlbCwgcnVuX3Jvb3QgLyAnbW9kZWwucHQnKQogICAgICAgIHZhbGlkYXRpb24obW9kZWwsIGNyaXRlcmlvbiwgdHFkbS50cWRtKHZhbGlkX2xvYWRlciwgZGVzYz0nVmFsaWRhdGlvbicpLAogICAgICAgICAgICAgICAgICAgdXNlX2N1ZGE9dXNlX2N1ZGEpCgogICAgZWxpZiBhcmdzLm1vZGUuc3RhcnRzd2l0aCgncHJlZGljdCcpOgogICAgICAgIGxvYWRfbW9kZWwobW9kZWwsIHJ1bl9yb290IC8gJ2Jlc3QtbW9kZWwucHQnKQogICAgICAgIHByZWRpY3Rfa3dhcmdzID0gZGljdCgKICAgICAgICAgICAgYmF0Y2hfc2l6ZT1hcmdzLmJhdGNoX3NpemUsCiAgICAgICAgICAgIHR0YT1hcmdzLnR0YSwKICAgICAgICAgICAgdXNlX2N1ZGE9dXNlX2N1ZGEsCiAgICAgICAgICAgIHdvcmtlcnM9YXJncy53b3JrZXJzLAogICAgICAgICkKICAgICAgICBpZiBhcmdzLm1vZGUgPT0gJ3ByZWRpY3RfdmFsaWQnOgogICAgICAgICAgICBwcmVkaWN0KG1vZGVsLCBkZj12YWxpZF9mb2xkLCByb290PXRyYWluX3Jvb3QsIG91dF9wYXRoPXJ1bl9yb290IC8gJ3ZhbC5oNScsICoqcHJlZGljdF9rd2FyZ3MpCiAgICAgICAgZWxpZiBhcmdzLm1vZGUgPT0gJ3ByZWRpY3RfdGVzdCc6CiAgICAgICAgICAgIHRlc3Rfcm9vdCA9IERBVEFfUk9PVCAvICgKICAgICAgICAgICAgICAgICd0ZXN0X3NhbXBsZScgaWYgYXJncy51c2Vfc2FtcGxlIGVsc2UgJ3Rlc3QnKQogICAgICAgICAgICBzcyA9IHBkLnJlYWRfY3N2KERBVEFfUk9PVCAvICdzYW1wbGVfc3VibWlzc2lvbi5jc3YnKQogICAgICAgICAgICBpZiBhcmdzLnVzZV9zYW1wbGU6CiAgICAgICAgICAgICAgICBzcyA9IHNzW3NzWydpZCddLmlzaW4oc2V0KGdldF9pZHModGVzdF9yb290KSkpXQogICAgICAgICAgICBpZiBhcmdzLmxpbWl0OgogICAgICAgICAgICAgICAgc3MgPSBzc1s6YXJncy5saW1pdF0KICAgICAgICAgICAgcHJlZGljdChtb2RlbCwgZGY9c3MsIHJvb3Q9dGVzdF9yb290LAogICAgICAgICAgICAgICAgICAgIG91dF9wYXRoPXJ1bl9yb290IC8gJ3Rlc3QuaDUnLAogICAgICAgICAgICAgICAgICAgICoqcHJlZGljdF9rd2FyZ3MpCgoKZGVmIHByZWRpY3QobW9kZWwsIHJvb3Q6IFBhdGgsIGRmOiBwZC5EYXRhRnJhbWUsIG91dF9wYXRoOiBQYXRoLAogICAgICAgICAgICBiYXRjaF9zaXplOiBpbnQsIHR0YTogaW50LCB3b3JrZXJzOiBpbnQsIHVzZV9jdWRhOiBib29sKToKICAgIGxvYWRlciA9IERhdGFMb2FkZXIoCiAgICAgICAgZGF0YXNldD1UVEFEYXRhc2V0KHJvb3QsIGRmLCB0ZXN0X3RyYW5zZm9ybSwgdHRhPXR0YSksCiAgICAgICAgc2h1ZmZsZT1GYWxzZSwKICAgICAgICBiYXRjaF9zaXplPWJhdGNoX3NpemUsCiAgICAgICAgbnVtX3dvcmtlcnM9d29ya2VycywKICAgICkKICAgIG1vZGVsLmV2YWwoKQogICAgYWxsX291dHB1dHMsIGFsbF9pZHMgPSBbXSwgW10KICAgIHdpdGggdG9yY2gubm9fZ3JhZCgpOgogICAgICAgIGZvciBpbnB1dHMsIGlkcyBpbiB0cWRtLnRxZG0obG9hZGVyLCBkZXNjPSdQcmVkaWN0Jyk6CiAgICAgICAgICAgIGlmIHVzZV9jdWRhOgogICAgICAgICAgICAgICAgaW5wdXRzID0gaW5wdXRzLmN1ZGEoKQogICAgICAgICAgICBvdXRwdXRzID0gdG9yY2guc2lnbW9pZChtb2RlbChpbnB1dHMpKQogICAgICAgICAgICBhbGxfb3V0cHV0cy5hcHBlbmQob3V0cHV0cy5kYXRhLmNwdSgpLm51bXB5KCkpCiAgICAgICAgICAgIGFsbF9pZHMuZXh0ZW5kKGlkcykKICAgIGRmID0gcGQuRGF0YUZyYW1lKAogICAgICAgIGRhdGE9bnAuY29uY2F0ZW5hdGUoYWxsX291dHB1dHMpLAogICAgICAgIGluZGV4PWFsbF9pZHMsCiAgICAgICAgY29sdW1ucz1tYXAoc3RyLCByYW5nZShOX0NMQVNTRVMpKSkKICAgIGRmID0gbWVhbl9kZihkZikKICAgIGRmLnRvX2hkZihvdXRfcGF0aCwgJ3Byb2InLCBpbmRleF9sYWJlbD0naWQnKQogICAgcHJpbnQoZidTYXZlZCBwcmVkaWN0aW9ucyB0byB7b3V0X3BhdGh9JykKCgpkZWYgdHJhaW4oYXJncywgbW9kZWw6IG5uLk1vZHVsZSwgY3JpdGVyaW9uLCAqLCBwYXJhbXMsCiAgICAgICAgICB0cmFpbl9sb2FkZXIsIHZhbGlkX2xvYWRlciwgaW5pdF9vcHRpbWl6ZXIsIHVzZV9jdWRhLAogICAgICAgICAgbl9lcG9jaHM9Tm9uZSwgcGF0aWVuY2U9MiwgbWF4X2xyX2NoYW5nZXM9MikgLT4gYm9vbDoKICAgIGxyID0gYXJncy5scgogICAgbl9lcG9jaHMgPSBuX2Vwb2NocyBvciBhcmdzLm5fZXBvY2hzCiAgICBwYXJhbXMgPSBsaXN0KHBhcmFtcykKICAgIG9wdGltaXplciA9IGluaXRfb3B0aW1pemVyKHBhcmFtcywgbHIpCgogICAgcnVuX3Jvb3QgPSBQYXRoKGFyZ3MucnVuX3Jvb3QpCiAgICBtb2RlbF9wYXRoID0gcnVuX3Jvb3QgLyAnbW9kZWwucHQnCiAgICBiZXN0X21vZGVsX3BhdGggPSBydW5fcm9vdCAvICdiZXN0LW1vZGVsLnB0JwogICAgaWYgbW9kZWxfcGF0aC5leGlzdHMoKToKICAgICAgICBzdGF0ZSA9IGxvYWRfbW9kZWwobW9kZWwsIG1vZGVsX3BhdGgpCiAgICAgICAgZXBvY2ggPSBzdGF0ZVsnZXBvY2gnXQogICAgICAgIHN0ZXAgPSBzdGF0ZVsnc3RlcCddCiAgICAgICAgYmVzdF92YWxpZF9sb3NzID0gc3RhdGVbJ2Jlc3RfdmFsaWRfbG9zcyddCiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGJlc3RfdmFsaWRfZjIgPSBzdGF0ZVsnYmVzdF92YWxpZF9mMiddCiAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZWxzZToKICAgICAgICBlcG9jaCA9IDEKICAgICAgICBzdGVwID0gMAogICAgICAgIGJlc3RfdmFsaWRfbG9zcyA9IGZsb2F0KCdpbmYnKQogICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICBiZXN0X3ZhbGlkX2YyID0gMAogICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGxyX2NoYW5nZXMgPSAwCgogICAgc2F2ZSA9IGxhbWJkYSBlcDogdG9yY2guc2F2ZSh7CiAgICAgICAgJ21vZGVsJzogbW9kZWwuc3RhdGVfZGljdCgpLAogICAgICAgICdlcG9jaCc6IGVwLAogICAgICAgICdzdGVwJzogc3RlcCwKICAgICAgICAnYmVzdF92YWxpZF9sb3NzJzogYmVzdF92YWxpZF9sb3NzLAogICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAnYmVzdF92YWxpZF9mMic6IGJlc3RfdmFsaWRfZjIKICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICB9LCBzdHIobW9kZWxfcGF0aCkpCgogICAgcmVwb3J0X2VhY2ggPSAxMDAwMAogICAgbG9nID0gcnVuX3Jvb3Quam9pbnBhdGgoJ3RyYWluLmxvZycpLm9wZW4oJ2F0JywgZW5jb2Rpbmc9J3V0ZjgnKQogICAgdmFsaWRfbG9zc2VzID0gW10KICAgIGxyX3Jlc2V0X2Vwb2NoID0gZXBvY2gKICAgIGZvciBlcG9jaCBpbiByYW5nZShlcG9jaCwgbl9lcG9jaHMgKyAxKToKICAgICAgICBtb2RlbC50cmFpbigpCiAgICAgICAgdHEgPSB0cWRtLnRxZG0odG90YWw9KGFyZ3MuZXBvY2hfc2l6ZSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4odHJhaW5fbG9hZGVyKSAqIGFyZ3MuYmF0Y2hfc2l6ZSkpCiAgICAgICAgdHEuc2V0X2Rlc2NyaXB0aW9uKGYnRXBvY2gge2Vwb2NofSwgbHIge2xyfScpCiAgICAgICAgbG9zc2VzID0gW10KICAgICAgICB0bCA9IHRyYWluX2xvYWRlcgogICAgICAgIGlmIGFyZ3MuZXBvY2hfc2l6ZToKICAgICAgICAgICAgdGwgPSBpc2xpY2UodGwsIGFyZ3MuZXBvY2hfc2l6ZSAvLyBhcmdzLmJhdGNoX3NpemUpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBtZWFuX2xvc3MgPSAwCiAgICAgICAgICAgIGZvciBpLCAoaW5wdXRzLCB0YXJnZXRzKSBpbiBlbnVtZXJhdGUodGwpOgogICAgICAgICAgICAgICAgaWYgdXNlX2N1ZGE6CiAgICAgICAgICAgICAgICAgICAgaW5wdXRzLCB0YXJnZXRzID0gaW5wdXRzLmN1ZGEoKSwgdGFyZ2V0cy5jdWRhKCkKICAgICAgICAgICAgICAgIG91dHB1dHMgPSBtb2RlbChpbnB1dHMpCiAgICAgICAgICAgICAgICBsb3NzID0gX3JlZHVjZV9sb3NzKGNyaXRlcmlvbihvdXRwdXRzLCB0YXJnZXRzKSkKICAgICAgICAgICAgICAgIGJhdGNoX3NpemUgPSBpbnB1dHMuc2l6ZSgwKQogICAgICAgICAgICAgICAgKGJhdGNoX3NpemUgKiBsb3NzKS5iYWNrd2FyZCgpCiAgICAgICAgICAgICAgICBpZiAoaSArIDEpICUgYXJncy5zdGVwID09IDA6CiAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVyLnN0ZXAoKQogICAgICAgICAgICAgICAgICAgIG9wdGltaXplci56ZXJvX2dyYWQoKQogICAgICAgICAgICAgICAgICAgIHN0ZXAgKz0gMQogICAgICAgICAgICAgICAgdHEudXBkYXRlKGJhdGNoX3NpemUpCiAgICAgICAgICAgICAgICBsb3NzZXMuYXBwZW5kKGxvc3MuaXRlbSgpKQogICAgICAgICAgICAgICAgbWVhbl9sb3NzID0gbnAubWVhbihsb3NzZXNbLXJlcG9ydF9lYWNoOl0pCiAgICAgICAgICAgICAgICB0cS5zZXRfcG9zdGZpeChsb3NzPWYne21lYW5fbG9zczouM2Z9JykKICAgICAgICAgICAgICAgIGlmIGkgYW5kIGkgJSByZXBvcnRfZWFjaCA9PSAwOgogICAgICAgICAgICAgICAgICAgIHdyaXRlX2V2ZW50KGxvZywgc3RlcCwgbG9zcz1tZWFuX2xvc3MpCiAgICAgICAgICAgIHdyaXRlX2V2ZW50KGxvZywgc3RlcCwgbG9zcz1tZWFuX2xvc3MpCiAgICAgICAgICAgIHRxLmNsb3NlKCkKICAgICAgICAgICAgc2F2ZShlcG9jaCArIDEpCiAgICAgICAgICAgIHZhbGlkX21ldHJpY3MgPSB2YWxpZGF0aW9uKG1vZGVsLCBjcml0ZXJpb24sIHZhbGlkX2xvYWRlciwgdXNlX2N1ZGEpCiAgICAgICAgICAgIHdyaXRlX2V2ZW50KGxvZywgc3RlcCwgKip2YWxpZF9tZXRyaWNzKQogICAgICAgICAgICB2YWxpZF9sb3NzID0gdmFsaWRfbWV0cmljc1sndmFsaWRfbG9zcyddCiAgICAgICAgICAgIHZhbGlkX2xvc3Nlcy5hcHBlbmQodmFsaWRfbG9zcykKICAgICAgICAgICAgaWYgdmFsaWRfbG9zcyA8IGJlc3RfdmFsaWRfbG9zczoKICAgICAgICAgICAgICAgIGJlc3RfdmFsaWRfbG9zcyA9IHZhbGlkX2xvc3MKICAgICAgICAgICAgICAgICMgc2h1dGlsLmNvcHkoc3RyKG1vZGVsX3BhdGgpLCBzdHIoYmVzdF9tb2RlbF9wYXRoKSkKICAgICAgICAgICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICBmb3IgaywgdiBpbiBzb3J0ZWQodmFsaWRfbWV0cmljcy5pdGVtcygpLCBrZXk9bGFtYmRhIGt2OiAta3ZbMV0pOgogICAgICAgICAgICAgICAgaWYgInZhbGlkX2YyIiBpbiBrOgogICAgICAgICAgICAgICAgICAgIHRoID0gawogICAgICAgICAgICAgICAgICAgIHZhbGlkX2YyID0gdgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGlmIGJlc3RfdmFsaWRfZjIgPCB2YWxpZF9mMjoKICAgICAgICAgICAgICAgIGJlc3RfdmFsaWRfZjIgPSB2YWxpZF9mMgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkoc3RyKG1vZGVsX3BhdGgpLCBzdHIoYmVzdF9tb2RlbF9wYXRoKSkKICAgICAgICAgICAgICAgIHByaW50KGYnU2F2ZWQgYmVzdCBtb2RlbCBhdCBFcG9jaCB7ZXBvY2h9LCBiZXN0X3ZhbGlkX2YyIHtiZXN0X3ZhbGlkX2YyfSwgdGgge3RofScpCiAgICAgICAgICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgZWxpZiAocGF0aWVuY2UgYW5kIGVwb2NoIC0gbHJfcmVzZXRfZXBvY2ggPiBwYXRpZW5jZSBhbmQKICAgICAgICAgICAgICAgICAgbWluKHZhbGlkX2xvc3Nlc1stcGF0aWVuY2U6XSkgPiBiZXN0X3ZhbGlkX2xvc3MpOgogICAgICAgICAgICAgICAgIyAicGF0aWVuY2UiIGVwb2NocyB3aXRob3V0IGltcHJvdmVtZW50CiAgICAgICAgICAgICAgICBscl9jaGFuZ2VzICs9IDEKICAgICAgICAgICAgICAgIGlmIGxyX2NoYW5nZXMgPiBtYXhfbHJfY2hhbmdlczoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgbHIgLz0gNQogICAgICAgICAgICAgICAgcHJpbnQoZidsciB1cGRhdGVkIHRvIHtscn0nKQogICAgICAgICAgICAgICAgbHJfcmVzZXRfZXBvY2ggPSBlcG9jaAogICAgICAgICAgICAgICAgb3B0aW1pemVyID0gaW5pdF9vcHRpbWl6ZXIocGFyYW1zLCBscikKICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgIHRxLmNsb3NlKCkKICAgICAgICAgICAgcHJpbnQoJ0N0cmwrQywgc2F2aW5nIHNuYXBzaG90JykKICAgICAgICAgICAgc2F2ZShlcG9jaCkKICAgICAgICAgICAgcHJpbnQoJ2RvbmUuJykKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gVHJ1ZQoKCmRlZiB2YWxpZGF0aW9uKAogICAgICAgIG1vZGVsOiBubi5Nb2R1bGUsIGNyaXRlcmlvbiwgdmFsaWRfbG9hZGVyLCB1c2VfY3VkYSwKICAgICAgICApIC0+IERpY3Rbc3RyLCBmbG9hdF06CiAgICBtb2RlbC5ldmFsKCkKICAgIGFsbF9sb3NzZXMsIGFsbF9wcmVkaWN0aW9ucywgYWxsX3RhcmdldHMgPSBbXSwgW10sIFtdCiAgICB3aXRoIHRvcmNoLm5vX2dyYWQoKToKICAgICAgICBmb3IgaW5wdXRzLCB0YXJnZXRzIGluIHZhbGlkX2xvYWRlcjoKICAgICAgICAgICAgYWxsX3RhcmdldHMuYXBwZW5kKHRhcmdldHMubnVtcHkoKS5jb3B5KCkpCiAgICAgICAgICAgIGlmIHVzZV9jdWRhOgogICAgICAgICAgICAgICAgaW5wdXRzLCB0YXJnZXRzID0gaW5wdXRzLmN1ZGEoKSwgdGFyZ2V0cy5jdWRhKCkKICAgICAgICAgICAgb3V0cHV0cyA9IG1vZGVsKGlucHV0cykKICAgICAgICAgICAgbG9zcyA9IGNyaXRlcmlvbihvdXRwdXRzLCB0YXJnZXRzKQogICAgICAgICAgICBhbGxfbG9zc2VzLmFwcGVuZChfcmVkdWNlX2xvc3MobG9zcykuaXRlbSgpKQogICAgICAgICAgICBwcmVkaWN0aW9ucyA9IHRvcmNoLnNpZ21vaWQob3V0cHV0cykKICAgICAgICAgICAgYWxsX3ByZWRpY3Rpb25zLmFwcGVuZChwcmVkaWN0aW9ucy5jcHUoKS5udW1weSgpKQogICAgYWxsX3ByZWRpY3Rpb25zID0gbnAuY29uY2F0ZW5hdGUoYWxsX3ByZWRpY3Rpb25zKQogICAgYWxsX3RhcmdldHMgPSBucC5jb25jYXRlbmF0ZShhbGxfdGFyZ2V0cykKCiAgICBkZWYgZ2V0X3Njb3JlKHlfcHJlZCk6CiAgICAgICAgd2l0aCB3YXJuaW5ncy5jYXRjaF93YXJuaW5ncygpOgogICAgICAgICAgICB3YXJuaW5ncy5zaW1wbGVmaWx0ZXIoJ2lnbm9yZScsIGNhdGVnb3J5PVVuZGVmaW5lZE1ldHJpY1dhcm5pbmcpCiAgICAgICAgICAgIHJldHVybiBmYmV0YV9zY29yZSgKICAgICAgICAgICAgICAgIGFsbF90YXJnZXRzLCB5X3ByZWQsIGJldGE9MiwgYXZlcmFnZT0nc2FtcGxlcycpCgogICAgbWV0cmljcyA9IHt9CiAgICBhcmdzb3J0ZWQgPSBhbGxfcHJlZGljdGlvbnMuYXJnc29ydChheGlzPTEpCiAgICBmb3IgdGhyZXNob2xkIGluIFswLjA1LCAwLjA2LCAwLjA3LCAwLjA4LCAwLjA5LCAwLjEwLCAwLjExLCAwLjEyLCAwLjEzLCAwLjE0LCAwLjE1LCAwLjIwXToKICAgICAgICBtZXRyaWNzW2YndmFsaWRfZjJfdGhfe3RocmVzaG9sZDouMmZ9J10gPSBnZXRfc2NvcmUoCiAgICAgICAgICAgIGJpbmFyaXplX3ByZWRpY3Rpb24oYWxsX3ByZWRpY3Rpb25zLCB0aHJlc2hvbGQsIGFyZ3NvcnRlZCkpCiAgICBtZXRyaWNzWyd2YWxpZF9sb3NzJ10gPSBucC5tZWFuKGFsbF9sb3NzZXMpCiAgICBwcmludCgnIHwgJy5qb2luKGYne2t9IHt2Oi4zZn0nIGZvciBrLCB2IGluIHNvcnRlZCgKICAgICAgICBtZXRyaWNzLml0ZW1zKCksIGtleT1sYW1iZGEga3Y6IC1rdlsxXSkpKQoKICAgIHJldHVybiBtZXRyaWNzCgoKZGVmIGJpbmFyaXplX3ByZWRpY3Rpb24ocHJvYmFiaWxpdGllcywgdGhyZXNob2xkOiBmbG9hdCwgYXJnc29ydGVkPU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbl9sYWJlbHM9MSwgbWF4X2xhYmVscz0xMCk6CiAgICAiIiIgUmV0dXJuIG1hdHJpeCBvZiAwLzEgcHJlZGljdGlvbnMsIHNhbWUgc2hhcGUgYXMgcHJvYmFiaWxpdGllcy4KICAgICIiIgogICAgYXNzZXJ0IHByb2JhYmlsaXRpZXMuc2hhcGVbMV0gPT0gTl9DTEFTU0VTCiAgICBpZiBhcmdzb3J0ZWQgaXMgTm9uZToKICAgICAgICBhcmdzb3J0ZWQgPSBwcm9iYWJpbGl0aWVzLmFyZ3NvcnQoYXhpcz0xKQogICAgbWF4X21hc2sgPSBfbWFrZV9tYXNrKGFyZ3NvcnRlZCwgbWF4X2xhYmVscykKICAgIG1pbl9tYXNrID0gX21ha2VfbWFzayhhcmdzb3J0ZWQsIG1pbl9sYWJlbHMpCiAgICBwcm9iX21hc2sgPSBwcm9iYWJpbGl0aWVzID4gdGhyZXNob2xkCiAgICByZXR1cm4gKG1heF9tYXNrICYgcHJvYl9tYXNrKSB8IG1pbl9tYXNrCgoKZGVmIF9tYWtlX21hc2soYXJnc29ydGVkLCB0b3BfbjogaW50KToKICAgIG1hc2sgPSBucC56ZXJvc19saWtlKGFyZ3NvcnRlZCwgZHR5cGU9bnAudWludDgpCiAgICBjb2xfaW5kaWNlcyA9IGFyZ3NvcnRlZFs6LCAtdG9wX246XS5yZXNoYXBlKC0xKQogICAgcm93X2luZGljZXMgPSBbaSAvLyB0b3BfbiBmb3IgaSBpbiByYW5nZShsZW4oY29sX2luZGljZXMpKV0KICAgIG1hc2tbcm93X2luZGljZXMsIGNvbF9pbmRpY2VzXSA9IDEKICAgIHJldHVybiBtYXNrCgoKZGVmIF9yZWR1Y2VfbG9zcyhsb3NzKToKICAgIHJldHVybiBsb3NzLnN1bSgpIC8gbG9zcy5zaGFwZVswXQoKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCk=',
                    'setup.py': 'ZnJvbSBzZXR1cHRvb2xzIGltcG9ydCBzZXR1cAoKc2V0dXAoCiAgICBuYW1lPSdpbWV0JywKICAgIHBhY2thZ2VzPVsnaW1ldCddLAop'
                    }


for path, encoded in file_data.items():
    print(path)
    path = Path(path)
    path.parent.mkdir(exist_ok=True)
    path.write_bytes(base64.b64decode(encoded))


def run(command):
    os.system('export PYTHONPATH=${PYTHONPATH}:/kaggle/working && ' + command)

## densenet121
#os.makedirs('../input/densenet121')
#shutil.copy('../input/pytorch-pretrained-image-models/densenet121.pth', '../input/densenet121/')

## densenet169 xxx
#os.makedirs('../input/densenet169')
#shutil.copy('../input/pytorch-pretrained-models/densenet169-b2777c0a.pth', '../input/densenet169/densenet169.pth')

## densenet201
#os.makedirs('../input/densenet201')
#shutil.copy('../input/pytorch-pretrained-image-models/densenet201.pth', '../input/densenet201/')

## densenet161 xxx
#os.makedirs('../input/densenet161')
#shutil.copy('../input/pytorch-densenet-pretrained/densenet161-8d451a50.pth', '../input/densenet161/densenet161.pth')

## inception v3
#os.makedirs('../input/inception_v3')
#shutil.copy('../input/pytorch-pretrained-models/inception_v3_google-1a9a5a14.pth', '../input/inception_v3/inception_v3.pth')

## se_resnet50
#os.makedirs('../input/se_resnet50')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnet50-ce0d4300.pth', '../input/se_resnet50/se_resnet50.pth')

## se_resnet101
#os.makedirs('../input/se_resnet101')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnet101-7e38fcc6.pth', '../input/se_resnet101/se_resnet101.pth')

## se_resnet152
#os.makedirs('../input/se_resnet152')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnet152-d17c99b7.pth', '../input/se_resnet152/se_resnet152.pth')

## se_resnext50_32x4d
os.makedirs('../input/se_resnext50_32x4d')
shutil.copy('../input/pytorch-pretrained-seresnet/se_resnext50_32x4d-a260b3a4.pth', '../input/se_resnext50_32x4d/se_resnext50_32x4d.pth')

## se_resnext101_32x4d
#os.makedirs('../input/se_resnext101_32x4d')
#shutil.copy('../input/pytorch-pretrained-seresnet/se_resnext101_32x4d-3b2fe3d8.pth', '../input/se_resnext101_32x4d/se_resnext101_32x4d.pth')


print(os.listdir('/kaggle/working/'))
run('python setup.py develop --install-dir /kaggle/working')
run('python -m imet.make_folds --n-folds 5 --seed 42')
run('python -m imet.main train model_1 --n-epochs 15 --model se_resnext50_32x4d --batch-size 32')
#print(os.listdir('/kaggle/working/'))
#run('python -m imet.main predict_test model_1 --model se_resnext101_32x4d --batch-size 32')
#run('python -m imet.make_submission model_1/test.h5 submission.csv --threshold 0.10')